<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>DSI Prompt Assistant</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
    body {
        font-family: 'Poppins', sans-serif;
        transition: background-color 0.3s, background-image 0.3s;
    }
    .chip {
        display: inline-flex;
        align-items: center;
        background-color: #e0e7ff;
        color: #4338ca;
        border-radius: 9999px;
        padding: 0.25rem 0.75rem;
        font-size: 0.875rem;
        margin: 0.25rem;
    }
    .chip button {
        margin-left: 0.5rem;
        cursor: pointer;
        font-weight: bold;
        background: none;
        border: none;
    }
    .prompt-box {
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    .hidden {
        display: none;
    }
    .accordion-header {
        cursor: pointer;
    }
    .accordion-content {
        display: none;
    }
    .accordion-content.active {
        display: block;
    }
    .home-card {
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .home-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
</style>
<meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport"/><meta content="#0b132b" name="theme-color"/><link href="./manifest.webmanifest" rel="manifest"/><link href="./icons/icon-192.png" rel="apple-touch-icon"/><style>:root { color-scheme: light dark; }
body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height: 1.5; }
main { max-width: 960px; margin: 0 auto; padding: clamp(12px, 3vw, 24px); }
button, .btn { min-height: 44px; padding: 10px 14px; border-radius: 12px; }
input, textarea, select { width: 100%; min-height: 44px; padding: 10px 12px; border-radius: 12px; }
</style>
</head>

<body class="bg-gray-50 text-gray-800">
<div class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden" id="modal-overlay">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm">
        <h3 class="text-lg font-semibold mb-2" id="modal-title"></h3>
        <p class="text-sm text-gray-600 mb-4" id="modal-text"></p>
        <div class="flex justify-end space-x-2">
            <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors" id="modal-cancel">Annuler</button>
            <button class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors" id="modal-confirm">Confirmer</button>
        </div>
    </div>
</div>

<header class="sticky top-0 z-10 w-full bg-white shadow-md py-4 transition-colors">
    <div class="container mx-auto px-4 flex justify-between items-center">
        <div class="flex items-center space-x-4">
            <div class="hidden" id="logo-container">
                <img class="h-10 w-auto" id="logo-preview"/>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 transition-colors" id="mainTitle">DSI Prompt Assistant</h1>
        </div>
        <div class="flex items-center space-x-2">
             <button class="p-2 rounded-full text-gray-500 hover:bg-gray-200 transition-colors hidden" id="home-btn" title="Accueil">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            </button>
            <button class="p-2 rounded-full text-gray-500 hover:bg-gray-200 transition-colors" id="settings-btn" title="Paramètres">
                <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.942 3.313.824 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.942 1.543-.824 3.313-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.942-3.313-.824-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.942-1.543.824-3.313 2.37-2.37.527.261 1.04-.567.922-1.123z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
            </button>
        </div>
    </div>
</header>

<div class="container mx-auto p-4 md:p-8 pt-12" id="home-panel">
    <div class="text-center mb-10">
        <h2 class="text-4xl font-bold text-gray-800">Bienvenue sur l'Assistant Prompt</h2>
        <p class="text-gray-600 mt-2">Choisissez un outil pour commencer à construire votre requête parfaite.</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-1 md:col-span-2">
            <div data-target="prompt-builder-panel" class="home-card bg-white p-6 rounded-lg shadow cursor-pointer flex flex-col items-center text-center border-2 border-indigo-600">
                <div class="bg-indigo-100 rounded-full p-4 mb-4">
                    <svg class="w-10 h-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                </div>
                <h3 class="text-xl font-semibold mb-2">Prompt Builder</h3>
                <p class="text-gray-600 text-sm">L'outil complet pour construire des prompts détaillés et structurés à partir de zéro.</p>
            </div>
        </div>
        
        <div class="lg:col-span-2 md:col-span-2 space-y-4">
            <h3 class="text-2xl font-semibold text-gray-700 border-b pb-2">Assistants Spécialisés</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div data-target="guided-assistant-panel" class="home-card bg-white p-4 rounded-lg shadow cursor-pointer text-center">
                    <h4 class="font-semibold text-indigo-700">Assistant Guidé</h4>
                    <p class="text-xs text-gray-500 mt-1">Créez un prompt pas à pas via un formulaire simple.</p>
                </div>
                <div data-target="summary-assistant-panel" class="home-card bg-white p-4 rounded-lg shadow cursor-pointer text-center">
                    <h4 class="font-semibold text-indigo-700">Compte Rendu</h4>
                    <p class="text-xs text-gray-500 mt-1">Générez des synthèses et analyses de documents.</p>
                </div>
                 <div data-target="assistant-info-panel" class="home-card bg-white p-4 rounded-lg shadow cursor-pointer text-center">
                    <h4 class="font-semibold text-indigo-700">Information</h4>
                    <p class="text-xs text-gray-500 mt-1">Apprendre, comprendre et vulgariser un sujet.</p>
                </div>
                <div data-target="assistant-creation-panel" class="home-card bg-white p-4 rounded-lg shadow cursor-pointer text-center">
                    <h4 class="font-semibold text-indigo-700">Création</h4>
                    <p class="text-xs text-gray-500 mt-1">Générer du contenu (texte, script, etc.).</p>
                </div>
                <div data-target="assistant-analysis-panel" class="home-card bg-white p-4 rounded-lg shadow cursor-pointer text-center">
                    <h4 class="font-semibold text-indigo-700">Analyse</h4>
                    <p class="text-xs text-gray-500 mt-1">Synthétiser, créer des plans, aider à la décision.</p>
                </div>
                <div data-target="assistant-problem-panel" class="home-card bg-white p-4 rounded-lg shadow cursor-pointer text-center">
                    <h4 class="font-semibold text-indigo-700">Résolution</h4>
                    <p class="text-xs text-gray-500 mt-1">Dépanner, trouver des solutions concrètes.</p>
                </div>
                <div data-target="assistant-training-panel" class="home-card bg-white p-4 rounded-lg shadow cursor-pointer text-center">
                    <h4 class="font-semibold text-indigo-700">Entraînement</h4>
                    <p class="text-xs text-gray-500 mt-1">Créer des quiz, des exercices, des pratiques guidées.</p>
                </div>
                <div data-target="assistant-organization-panel" class="home-card bg-white p-4 rounded-lg shadow cursor-pointer text-center">
                    <h4 class="font-semibold text-indigo-700">Organisation</h4>
                    <p class="text-xs text-gray-500 mt-1">Planifier, créer des modèles et comptes rendus.</p>
                </div>
                <div data-target="assistant-simulation-panel" class="home-card bg-white p-4 rounded-lg shadow cursor-pointer text-center">
                    <h4 class="font-semibold text-indigo-700">Simulation</h4>
                    <p class="text-xs text-gray-500 mt-1">Dialoguer avec un rôle, un persona, une simulation.</p>
                </div>

<div data-target="assistant-developers-panel" class="home-card bg-white p-4 rounded-lg shadow cursor-pointer text-center">
    <h4 class="font-semibold text-indigo-700">Développeurs</h4>
    <p class="text-xs text-gray-500 mt-1">Création, assistance, debug, revue et tests de code.</p>
</div>

            </div>
        </div>
    </div>
</div>

<div class="container mx-auto p-4 md:p-8 pt-8 hidden" id="prompt-builder-panel">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2 space-y-6">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Contexte et Cibles</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="block text-sm font-medium text-gray-700" for="company">Contexte de l'entreprise</label><textarea class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 p-2" id="company" placeholder="Ex: MaSuperEntreprise Inc." rows="2"></textarea></div>
                    <div><label class="block text-sm font-medium text-gray-700" for="sector">Secteur d'activité</label><textarea class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 p-2" id="sector" placeholder="Décrivez le secteur d'activité, les métiers concernés,..." rows="2"></textarea></div>
                    <div><label class="block text-sm font-medium text-gray-700" for="audience">Audience</label><input class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 p-2" id="audience" placeholder="Décrivez les personnes qui liront la réponse (ex: 'Direction technique', 'Équipe marketing', 'Utilisateurs finaux')." type="text"/></div>
                    <div><label class="block text-sm font-medium text-gray-700" for="deadline">Échéance</label><input class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 p-2" id="deadline" placeholder="Ex: 'Avant la fin de la semaine', '25/12/2025'" type="text"/></div>
                </div>
                <div class="mt-4"><label class="block text-sm font-medium text-gray-700" for="goals">Objectifs de la tâche</label><textarea class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 p-2" id="goals" placeholder="Décrivez ce que le résultat doit accomplir (ex: 'Obtenir l'approbation du budget', 'Convaincre un client potentiel')." rows="2"></textarea></div>
                <div class="mt-4"><label class="block text-sm font-medium text-gray-700" for="constraints">Contraintes et limitations</label><textarea class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 p-2" id="constraints" placeholder="Ex: 'Utiliser uniquement les données fournies', 'Ne pas dépasser 500 mots', 'Equipe IT réduite',..." rows="2"></textarea></div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="accordion-header text-xl font-semibold mb-4 flex justify-between items-center">Définition du Prompt<svg class="w-5 h-5 transition-transform duration-200 transform" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg></h2>
                <div class="accordion-content active space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700" for="domain">Domaine d'expertise</label><select class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="domain"></select></div>
                        <div><label class="block text-sm font-medium text-gray-700" for="role">Rôle de l'IA</label><select class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="role"></select></div>
                        <div><label class="block text-sm font-medium text-gray-700" for="tone">Ton</label><select class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="tone"></select></div>
                        <div><label class="block text-sm font-medium text-gray-700" for="lang">Langue</label><select class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="lang"></select></div>
                        <div><label class="block text-sm font-medium text-gray-700" for="format">Format de sortie</label><select class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="format"></select></div>
                        <div><label class="block text-sm font-medium text-gray-700" for="detail">Niveau de détail</label><select class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="detail"></select></div>
                    </div>
                    <div class="mt-4"><label class="block text-sm font-medium text-gray-700" for="length">Longueur (facultatif)</label><input class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="length" placeholder="ex: 500 mots, 3 paragraphes, 10 phrases" type="text"/></div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="accordion-header text-xl font-semibold mb-4 flex justify-between items-center">Stratégies Avancées<svg class="w-5 h-5 transition-transform duration-200 transform" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg></h2>
                <div class="accordion-content space-y-4">
                    <label class="flex items-center text-sm font-medium text-gray-700 mb-2"><input class="h-4 w-4 text-indigo-600 rounded" id="chainOfThought" type="checkbox"/><span class="ml-2">Raisonnement Étape par Étape (Chain of Thought)</span></label>
                    <label class="flex items-center text-sm font-medium text-gray-700 mb-2"><input class="h-4 w-4 text-indigo-600 rounded" id="genKnowledge" type="checkbox"/><span class="ml-2">Génération de Connaissances (Generated Knowledge)</span></label>
                    <div class="ml-6 mt-2 hidden" id="genKnowledgeFields"><label class="block text-sm font-medium text-gray-700" for="knowledgeSubject">Sujet à synthétiser</label><input class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="knowledgeSubject" placeholder="ex: l'histoire du framework React" type="text"/></div>
                    <label class="flex items-center text-sm font-medium text-gray-700"><input class="h-4 w-4 text-indigo-600 rounded" id="selfReflection" type="checkbox"/><span class="ml-2">Auto-évaluation (Self-Reflection)</span></label>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="accordion-header text-xl font-semibold mb-4 flex justify-between items-center">Tâche et Critères<svg class="w-5 h-5 transition-transform duration-200 transform" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg></h2>
                <div class="accordion-content space-y-4">
                    <div class="flex flex-wrap gap-2 mb-4" id="quick-tasks"></div>
                    <div><label class="block text-sm font-medium text-gray-700" for="task">Description de la tâche</label><textarea class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="task" placeholder="Formulez de manière claire, précise et sans ambiguïté." rows="6"></textarea></div>
                    <div><label class="block text-sm font-medium text-gray-700" for="acceptance">Critères d'acceptation</label><p class="text-xs text-gray-500 mb-2">Décomposez la tâche en étapes spécifiques ou décrivez les critères pour considérer que la réponse est réussie.</p><textarea class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="acceptance" rows="3"></textarea></div>
                    <div><label class="block text-sm font-medium text-gray-700" for="examples">Exemples de sortie (Few-shot Prompting)</label><p class="text-xs text-gray-500 mb-2">Fournissez un ou plusieurs exemples de la sortie souhaitée pour guider le modèle.</p><textarea class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="examples" rows="6"></textarea></div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="accordion-header text-xl font-semibold mb-4 flex justify-between items-center">Options supplémentaires<svg class="w-5 h-5 transition-transform duration-200 transform" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg></h2>
                <div class="accordion-content space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="risks" type="checkbox"/><span class="ml-2 text-gray-700">Inclure les risques</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="costs" type="checkbox"/><span class="ml-2 text-gray-700">Estimer les coûts/TCO</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="kpi" type="checkbox"/><span class="ml-2 text-gray-700">Inclure des KPI/mesures de succès</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="deps" type="checkbox"/><span class="ml-2 text-gray-700">Mentionner les dépendances</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="limits" type="checkbox"/><span class="ml-2 text-gray-700">Indiquer les limites et hypothèses</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="sources" type="checkbox"/><span class="ml-2 text-gray-700">Fournir des sources ou références</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="allowUnknown" type="checkbox"/><span class="ml-2 text-gray-700">Répondre "Je ne sais pas" si inconnu</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="listUnknowns" type="checkbox"/><span class="ml-2 text-gray-700">Lister les inconnues</span></label>
                    </div>
                    <div class="mt-4 flex items-center justify-between">
                        <label class="flex items-center text-sm font-medium text-gray-700"><input class="h-4 w-4 text-indigo-600 rounded" id="teamMode" type="checkbox"/><span class="ml-2">Mode équipe</span></label>
                        <select class="w-2/3 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="team"></select>
                    </div>
                    <div class="hidden mt-4 bg-gray-50 p-4 rounded-lg" id="team-section"><h4 class="text-sm font-semibold mb-2">Ajouts au prompt :</h4><ul class="text-sm text-gray-600 list-disc list-inside" id="team-adds"></ul></div>
                </div>
            </div>
        </div>
        <div class="lg:col-span-1 space-y-4">
            <div class="sticky top-20 bg-gray-100 p-6 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Prompt Généré</h2>
                <div class="prompt-box bg-white p-4 rounded-md text-gray-700 text-sm overflow-auto max-h-96" id="preview"></div>
                <div class="flex flex-col space-y-2 mt-4">
                    <button class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors" id="copy-btn">Copier le Prompt</button>
                    <span class="hidden text-center text-xs text-green-600 font-medium" id="copied-badge">Copié ! ✅</span>
                    <button class="hidden px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors" id="clear-btn">Effacer les entrées</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto p-4 md:p-8 pt-8 hidden" id="summary-assistant-panel">
    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Assistant de Compte Rendu Détaillé</h1>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">1. Contexte</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="summaryContextType" class="block text-sm font-medium text-gray-700">Type de source</label>
                            <select id="summaryContextType" class="mt-1 block w-full rounded-md border-gray-300">
                                <option>Texte brut</option>
                                <option>Retranscription de réunion</option>
                                <option>Vidéo</option>
                                <option>Article de presse</option>
                                <option>Cours / Formation</option>
                                <option>Conférence</option>
                                <option>Document PDF</option>
                            </select>
                        </div>
                        <div class="mt-2 bg-blue-50 border-l-4 border-blue-400 p-3 rounded-r-lg">
                            <p class="text-sm text-blue-700"><strong>Rappel :</strong> Vous devrez téléverser votre fichier dans l'interface de l'IA.</p>
                        </div>
                        <div>
                            <label for="summaryContextAudience" class="block text-sm font-medium text-gray-700">Public Cible</label>
                            <input type="text" id="summaryContextAudience" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex: experts, étudiants, décideurs...">
                        </div>
                        <div>
                            <label for="summaryContextObjective" class="block text-sm font-medium text-gray-700">Objectif du compte rendu</label>
                            <select id="summaryContextObjective" class="mt-1 block w-full rounded-md border-gray-300">
                                <option>Informer</option>
                                <option>Enseigner / Former</option>
                                <option>Convaincre / Persuader</option>
                                <option>Mémoriser / Réviser</option>
                                <option>Partager rapidement les points clés</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">2. Format Attendu</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="summaryFormatType" class="block text-sm font-medium text-gray-700">Type de sortie</label>
                            <select id="summaryFormatType" class="mt-1 block w-full rounded-md border-gray-300">
                                <option>Résumé simple</option>
                                <option>Fiche synthétique</option>
                                <option>Plan détaillé</option>
                                <option>Analyse critique</option>
                                <option>FAQ (Foire aux questions)</option>
                                <option>Tableau comparatif</option>
                            </select>
                        </div>
                        <div>
                            <label for="summaryFormatDetail" class="block text-sm font-medium text-gray-700">Niveau de détail</label>
                            <select id="summaryFormatDetail" class="mt-1 block w-full rounded-md border-gray-300">
                                <option>Ultra-condensé (quelques phrases)</option>
                                <option>Intermédiaire (~1 page)</option>
                                <option>Exhaustif (plusieurs pages)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Structure</label>
                            <div class="mt-2 grid grid-cols-2 gap-2 text-sm">
                                <label class="flex items-center"><input type="checkbox" id="summaryStructureBullets" class="h-4 w-4 rounded"><span class="ml-2">Points clés / Bullet points</span></label>
                                <label class="flex items-center"><input type="checkbox" id="summaryStructureParagraphs" class="h-4 w-4 rounded"><span class="ml-2">Paragraphes développés</span></label>
                                <label class="flex items-center"><input type="checkbox" id="summaryStructurePlan" class="h-4 w-4 rounded"><span class="ml-2">Plan hiérarchisé (I, II, A, B...)</span></label>
                                <label class="flex items-center"><input type="checkbox" id="summaryStructureTable" class="h-4 w-4 rounded"><span class="ml-2">Tableaux / Schémas</span></label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">3. Style d'Écriture</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="summaryStyleTone" class="block text-sm font-medium text-gray-700">Ton</label>
                            <select id="summaryStyleTone" class="mt-1 block w-full rounded-md border-gray-300">
                                <option>Neutre</option><option>Académique</option><option>Journalistique</option>
                                <option>Vulgarisé</option><option>Professionnel</option><option>Engageant</option>
                            </select>
                        </div>
                        <div>
                            <label for="summaryStyleComplexity" class="block text-sm font-medium text-gray-700">Complexité</label>
                            <select id="summaryStyleComplexity" class="mt-1 block w-full rounded-md border-gray-300">
                                <option>Langage simple</option>
                                <option>Langage technique</option>
                                <option>Langage expert</option>
                            </select>
                        </div>
                        <div>
                            <label for="summaryStyleVoice" class="block text-sm font-medium text-gray-700">Voix</label>
                            <select id="summaryStyleVoice" class="mt-1 block w-full rounded-md border-gray-300">
                                <option>Impersonnelle</option>
                                <option>Inclusive</option>
                                <option>Narrative</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">4. Angle et Priorités</h2>
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-gray-700">Mettre en avant :</label>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <label class="flex items-center"><input type="checkbox" id="summaryAngleIdeas" class="h-4 w-4 rounded"><span class="ml-2">Idées principales</span></label>
                            <label class="flex items-center"><input type="checkbox" id="summaryAngleArgs" class="h-4 w-4 rounded"><span class="ml-2">Arguments</span></label>
                            <label class="flex items-center"><input type="checkbox" id="summaryAngleFacts" class="h-4 w-4 rounded"><span class="ml-2">Faits & Chiffres</span></label>
                            <label class="flex items-center"><input type="checkbox" id="summaryAngleQuotes" class="h-4 w-4 rounded"><span class="ml-2">Citations marquantes</span></label>
                        </div>
                        <label class="block text-sm font-medium text-gray-700 pt-2">Ajouter :</label>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <label class="flex items-center"><input type="checkbox" id="summaryAngleContext" class="h-4 w-4 rounded"><span class="ml-2">Explications contextuelles</span></label>
                            <label class="flex items-center"><input type="checkbox" id="summaryAngleDefs" class="h-4 w-4 rounded"><span class="ml-2">Définitions</span></label>
                            <label class="flex items-center"><input type="checkbox" id="summaryAngleLinks" class="h-4 w-4 rounded"><span class="ml-2">Liens logiques</span></label>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">5. Analyse et Enrichissement</h2>
                    <div class="grid grid-cols-1 gap-2 text-sm">
                        <label class="flex items-center"><input type="checkbox" id="summaryAnalysisStrengths" class="h-4 w-4 rounded"><span class="ml-2">Identifier les points forts / faibles</span></label>
                        <label class="flex items-center"><input type="checkbox" id="summaryAnalysisImplications" class="h-4 w-4 rounded"><span class="ml-2">Relever les implications, enjeux, conséquences</span></label>
                        <label class="flex items-center"><input type="checkbox" id="summaryAnalysisQuestions" class="h-4 w-4 rounded"><span class="ml-2">Dégager les questions ouvertes ou controverses</span></label>
                        <label class="flex items-center"><input type="checkbox" id="summaryAnalysisCompare" class="h-4 w-4 rounded"><span class="ml-2">Comparer avec d'autres sources (si pertinent)</span></label>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">6. Contraintes et Omissions</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="summaryConstraintLength" class="block text-sm font-medium text-gray-700">Longueur maximale</label>
                            <input type="text" id="summaryConstraintLength" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex: 200 mots, 1 page, 5 bullet points">
                        </div>
                        <div>
                            <label for="summaryConstraintOmit" class="block text-sm font-medium text-gray-700">Détails spécifiques à omettre</label>
                            <textarea id="summaryConstraintOmit" rows="2" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex: anecdotes mineures, répétitions...">Small talk, incohérences</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Mise en valeur</label>
                            <div class="mt-2 grid grid-cols-2 gap-2 text-sm">
                                <label class="flex items-center"><input type="checkbox" id="summaryConstraintTitles" class="h-4 w-4 rounded"><span class="ml-2">Titres et sous-titres</span></label>
                                <label class="flex items-center"><input type="checkbox" id="summaryConstraintBold" class="h-4 w-4 rounded"><span class="ml-2">Gras pour les termes clés</span></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <div class="sticky top-20 bg-gray-100 p-6 rounded-lg shadow-inner">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Prompt de Synthèse Généré</h2>
                    <div class="prompt-box bg-white p-4 rounded-md text-gray-700 text-sm overflow-auto max-h-[75vh]" id="summary-preview">Remplissez les champs pour générer le prompt...</div>
                    <div class="flex flex-col space-y-2 mt-4">
                        <button class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700" id="summary-copy-btn">Copier le Prompt</button>
                        <span class="hidden text-center text-xs text-green-600 font-medium" id="summary-copied-badge">Copié ! ✅</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto p-4 md:p-8 pt-8 hidden" id="guided-assistant-panel">
    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Assistant Guidé de Création de Prompt</h1>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">1. Contexte de la demande</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="guidedWho" class="block text-sm font-medium text-gray-700">Qui pose la question ?</label>
                            <select id="guidedWho" class="mt-1 block w-full rounded-md border-gray-300"></select>
                        </div>
                        <div>
                            <label for="guidedWhy" class="block text-sm font-medium text-gray-700">Pourquoi ? (Objectif)</label>
                            <select id="guidedWhy" class="mt-1 block w-full rounded-md border-gray-300"></select>
                        </div>
                        <div>
                            <label for="guidedDomain" class="block text-sm font-medium text-gray-700">Domaine</label>
                            <select id="guidedDomain" class="mt-1 block w-full rounded-md border-gray-300"></select>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">2. Type de réponse attendue</h2>
                    <select id="guidedResponseType" class="mt-1 block w-full rounded-md border-gray-300">
                        <option value="Explique-moi simplement…">Explicative : "Explique-moi simplement…"</option>
                        <option value="Montre-moi par étapes comment…">Démonstrative : "Montre-moi par étapes comment…"</option>
                        <option value="Compare X et Y sur ces critères…">Comparative : "Compare X et Y sur ces critères…"</option>
                        <option value="Analyse les avantages et limites de…">Critique : "Analyse les avantages et limites de…"</option>
                        <option value="Donne-moi un guide étape par étape pour…">Pratique : "Donne-moi un guide étape par étape pour…"</option>
                    </select>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">3. Format</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="guidedFormat" class="block text-sm font-medium text-gray-700">Format de sortie</label>
                            <select id="guidedFormat" class="mt-1 block w-full rounded-md border-gray-300"></select>
                        </div>
                        <div>
                            <label for="guidedStyle" class="block text-sm font-medium text-gray-700">Style</label>
                            <select id="guidedStyle" class="mt-1 block w-full rounded-md border-gray-300"></select>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">4. Contraintes</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="guidedLength" class="block text-sm font-medium text-gray-700">Longueur (optionnel)</label>
                            <input type="text" id="guidedLength" class="mt-1 block w-full rounded-md border-gray-300" placeholder="pas plus de 200 mots, en 5 points…">
                        </div>
                        <div>
                            <label for="guidedLanguageLevel" class="block text-sm font-medium text-gray-700">Niveau de langage</label>
                            <select id="guidedLanguageLevel" class="mt-1 block w-full rounded-md border-gray-300"></select>
                        </div>
                        <label class="flex items-center"><input type="checkbox" id="guidedExamples" class="h-4 w-4 rounded"><span class="ml-2">Exemples concrets obligatoires</span></label>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">5. Précisions / Cadrage</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="guidedInclude" class="block text-sm font-medium text-gray-700">Ce qu'il faut inclure absolument</label>
                            <textarea id="guidedInclude" rows="2" class="mt-1 block w-full rounded-md border-gray-300" placeholder="définitions, exemples, chiffres…"></textarea>
                        </div>
                        <div>
                            <label for="guidedExclude" class="block text-sm font-medium text-gray-700">Ce qu'il faut exclure</label>
                            <textarea id="guidedExclude" rows="2" class="mt-1 block w-full rounded-md border-gray-300" placeholder="détails trop techniques, jargon, spéculation…"></textarea>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">6. Ajouts avancés</h2>
                    <div class="space-y-2">
                        <label class="flex items-center"><input type="checkbox" id="guidedAdvancedCOT" class="h-4 w-4 rounded"><span class="ml-2 text-sm">Raisonnement étape par étape</span></label>
                        <label class="flex items-center"><input type="checkbox" id="guidedAdvancedKnowledge" class="h-4 w-4 rounded"><span class="ml-2 text-sm">Génération de connaissances</span></label>
                        <label class="flex items-center"><input type="checkbox" id="guidedAdvancedSelfReflect" class="h-4 w-4 rounded"><span class="ml-2 text-sm">Auto-évaluation</span></label>
                    </div>
                </div>
            </div>
            <div>
                <div class="sticky top-20 bg-gray-100 p-6 rounded-lg shadow-inner">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Votre Demande</h2>
                    <p class="text-sm text-gray-600 mb-4">Rédigez ici votre question principale. Les éléments du formulaire seront automatiquement ajoutés pour la préciser.</p>
                    <textarea id="guidedMainRequest" rows="8" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex: Explique la physique quantique."></textarea>
                    <h2 class="text-xl font-semibold mt-6 mb-4 text-gray-800">Prompt Final Généré</h2>
                    <div class="prompt-box bg-white p-4 rounded-md text-gray-700 text-sm overflow-auto max-h-[45vh]" id="guided-preview">Remplissez les champs pour générer le prompt...</div>
                    <div class="flex flex-col space-y-2 mt-4">
                        <button class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700" id="guided-copy-btn">Copier le Prompt</button>
                        <span class="hidden text-center text-xs text-green-600 font-medium" id="guided-copied-badge">Copié ! ✅</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto p-4 md:p-8 pt-8 hidden" id="assistant-info-panel">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Assistant Information / Compréhension</h1>
        <div class="bg-white p-6 rounded-lg shadow">
            <label class="block text-sm font-medium text-gray-700" for="info-task">Quel sujet souhaitez-vous apprendre ou vulgariser ?</label>
            <textarea id="info-task" rows="4" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex: la théorie de la relativité, le fonctionnement du machine learning..."></textarea>
            <div class="mt-4 sticky top-20 bg-gray-100 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">Prompt Généré</h3>
                <div class="prompt-box bg-white p-2 rounded text-sm" id="info-preview"></div>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto p-4 md:p-8 pt-8 hidden" id="assistant-creation-panel">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Assistant Production / Création</h1>
        <div class="bg-white p-6 rounded-lg shadow">
            <label class="block text-sm font-medium text-gray-700" for="creation-task">Quel type de contenu souhaitez-vous générer ?</label>
            <textarea id="creation-task" rows="4" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex: un article de blog sur les voyages, un script pour une vidéo YouTube..."></textarea>
            <div class="mt-4 sticky top-20 bg-gray-100 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">Prompt Généré</h3>
                <div class="prompt-box bg-white p-2 rounded text-sm" id="creation-preview"></div>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto p-4 md:p-8 pt-8 hidden" id="assistant-analysis-panel">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Assistant Analyse / Structuration</h1>
        <div class="bg-white p-6 rounded-lg shadow">
            <label class="block text-sm font-medium text-gray-700" for="analysis-task">Quel document ou idée souhaitez-vous analyser ou structurer ?</label>
            <textarea id="analysis-task" rows="4" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex: synthétiser ce rapport de 10 pages, créer le plan d'un livre blanc..."></textarea>
            <div class="mt-4 sticky top-20 bg-gray-100 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">Prompt Généré</h3>
                <div class="prompt-box bg-white p-2 rounded text-sm" id="analysis-preview"></div>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto p-4 md:p-8 pt-8 hidden" id="assistant-problem-panel">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Assistant Résolution de Problèmes</h1>
        <div class="bg-white p-6 rounded-lg shadow">
            <label class="block text-sm font-medium text-gray-700" for="problem-task">Quel problème cherchez-vous à résoudre ?</label>
            <textarea id="problem-task" rows="4" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex: mon code Python a une erreur, comment puis-je organiser une campagne marketing à petit budget..."></textarea>
            <div class="mt-4 sticky top-20 bg-gray-100 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">Prompt Généré</h3>
                <div class="prompt-box bg-white p-2 rounded text-sm" id="problem-preview"></div>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto p-4 md:p-8 pt-8 hidden" id="assistant-training-panel">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Assistant Apprentissage / Entraînement</h1>
        <div class="bg-white p-6 rounded-lg shadow">
            <label class="block text-sm font-medium text-gray-700" for="training-task">Sur quel sujet voulez-vous vous entraîner ?</label>
            <textarea id="training-task" rows="4" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex: crée-moi un quiz de 10 questions sur l'histoire de France, guide-moi pour apprendre les bases de la guitare..."></textarea>
            <div class="mt-4 sticky top-20 bg-gray-100 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">Prompt Généré</h3>
                <div class="prompt-box bg-white p-2 rounded text-sm" id="training-preview"></div>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto p-4 md:p-8 pt-8 hidden" id="assistant-organization-panel">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Assistant Organisation / Productivité</h1>
        <div class="bg-white p-6 rounded-lg shadow">
            <label class="block text-sm font-medium text-gray-700" for="organization-task">Pour quelle tâche d'organisation avez-vous besoin d'aide ?</label>
            <textarea id="organization-task" rows="4" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex: rédiger le compte rendu de notre dernière réunion, créer un planning pour mon projet..."></textarea>
            <div class="mt-4 sticky top-20 bg-gray-100 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">Prompt Généré</h3>
                <div class="prompt-box bg-white p-2 rounded text-sm" id="organization-preview"></div>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto p-4 md:p-8 pt-8 hidden" id="assistant-simulation-panel">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Assistant Interaction / Dialogue Simulé</h1>
        <div class="bg-white p-6 rounded-lg shadow">
            <label class="block text-sm font-medium text-gray-700" for="simulation-task">Quel personnage ou quelle situation voulez-vous simuler ?</label>
            <textarea id="simulation-task" rows="4" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex: agis comme un recruteur pour un entretien d'embauche, simule une conversation avec un client mécontent..."></textarea>
            <div class="mt-4 sticky top-20 bg-gray-100 p-4 rounded-lg">
                <h3 class="font-semibold mb-2">Prompt Généré</h3>
                <div class="prompt-box bg-white p-2 rounded text-sm" id="simulation-preview"></div>
            </div>
        </div>
    </div>
</div>


<div class="container mx-auto p-4 md:p-8 pt-8 hidden" id="assistant-developers-panel">
  <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Left: Form -->
    <div class="bg-white p-6 rounded-lg shadow space-y-6">
      <h1 class="text-3xl font-bold text-gray-800">Assistant Développeurs</h1>
      <p class="text-sm text-gray-600 -mt-1">Construisez un prompt de développement précis pour créer, dépanner, optimiser ou revoir du code.</p>

      <div>
        <label class="block text-sm font-medium text-gray-700" for="dev-request-type">Type de demande</label>
        <select id="dev-request-type" class="mt-1 block w-full rounded-md border-gray-300">
<optgroup label="Création & Fonctionnalités">
  <option>Création de code</option>
  <option>Ajout de fonctionnalité</option>
  <option>Scaffolding / Boilerplate</option>
  <option>Architecture / API / Conception</option>
  <option>Design de schéma de données / DB</option>
</optgroup>
<optgroup label="Qualité & Maintenance">
  <option>Debug / Correction d'erreurs</option>
  <option>Relecture / Refactorisation</option>
  <option>Optimisation / Performance</option>
  <option>Stabilisation / Gestion des erreurs</option>
  <option>Durcissement sécurité</option>
</optgroup>
<optgroup label="Évolutions & Migration">
  <option>Migration de version / Upgrade dépendances</option>
  <option>Portage vers autre langage / runtime</option>
  <option>Découpage monolithe → microservices</option>
</optgroup>
<optgroup label="Tests & Vérification">
  <option>Tests (unitaires)</option>
  <option>Tests (intégration)</option>
  <option>Tests (end-to-end)</option>
  <option>Tests (contrat / property-based)</option>
  <option>Mock server / Fixtures</option>
</optgroup>
<optgroup label="CI/CD & Infra">
  <option>Pipeline CI/CD</option>
  <option>Conteneurisation / Docker</option>
  <option>Infra as Code (Terraform/Ansible)</option>
  <option>Déploiement serverless / FaaS</option>
  <option>Observabilité (logs/metrics/traces)</option>
</optgroup>
<optgroup label="Données & ML">
  <option>ETL / Traitement de données</option>
  <option>API de données / Analytics</option>
  <option>Pipeline ML / MLOps</option>
</optgroup>
<optgroup label="Front & Mobile">
  <option>Composant UI</option>
  <option>App Web SPA/SSR</option>
  <option>Application Mobile</option>
</optgroup>
        </select>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700" for="dev-languages">Langages & technos</label>
          <input id="dev-languages" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Ex : Python 3.12, Node 20, React 18, Django 5, Docker"/>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700" for="dev-env">Versions / Environnement</label>
          <input id="dev-env" class="mt-1 block w-full rounded-md border-gray-300" placeholder="OS, runtime, base d'images, GPU/CPU, RAM…"/>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700" for="dev-context">Contexte du projet</label>
        <textarea id="dev-context" rows="3" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Stack, objectifs, contraintes, dépendances…"></textarea>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700" for="dev-specs">Spécifications / cas d'usage</label>
        <textarea id="dev-specs" rows="3" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Règles métier, flux, endpoints, I/O, formats…"></textarea>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700" for="dev-inputs">Entrées disponibles</label>
          <textarea id="dev-inputs" rows="3" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Données, API, DB, fichiers, logs…"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700" for="dev-edge-cases">Cas limites / jeux d'essai</label>
          <textarea id="dev-edge-cases" rows="3" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Entrées extrêmes, erreurs attendues, volumétrie…"></textarea>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700" for="dev-constraints">Contraintes techniques</label>
        <textarea id="dev-constraints" rows="3" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Perf, sécurité, compatibilité, styleguide, licences…"></textarea>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700" for="dev-output-type">Format de sortie attendu</label>
          <select id="dev-output-type" class="mt-1 block w-full rounded-md border-gray-300">
<optgroup label="Code / Modules">
  <option>Snippet unique</option>
  <option>Fichier complet</option>
  <option>Module / Service</option>
  <option>Bibliothèque / Package</option>
  <option>Composant UI</option>
  <option>CLI (application ligne de commande)</option>
  <option>API REST (endpoint + handler)</option>
  <option>GraphQL (schema + resolvers)</option>
  <option>gRPC (proto + serveur)</option>
  <option>Fonction serverless (AWS/GCP/Azure)</option>
</optgroup>
<optgroup label="Tests">
  <option>Tests unitaires</option>
  <option>Tests d'intégration</option>
  <option>Tests end-to-end</option>
  <option>Tests de contrat</option>
  <option>Tests property-based</option>
  <option>Benchmarks de performance</option>
</optgroup>
<optgroup label="Infra & DevOps">
  <option>Dockerfile</option>
  <option>docker-compose</option>
  <option>Helm chart</option>
  <option>Terraform module</option>
  <option>GitHub Actions workflow</option>
  <option>GitLab CI pipeline</option>
  <option>Makefile</option>
</optgroup>
<optgroup label="Base de données">
  <option>Migration SQL</option>
  <option>Schéma DB (SQL/ORM)</option>
  <option>Seeder / Fixtures</option>
</optgroup>
<optgroup label="Docs">
  <option>README</option>
  <option>OpenAPI / Swagger</option>
  <option>Notes de PR</option>
  <option>ADR (Architecture Decision Record)</option>
</optgroup>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700" for="dev-explain-level">Niveau d'explication</label>
          <select id="dev-explain-level" class="mt-1 block w-full rounded-md border-gray-300">
<optgroup label="Débutant">
  <option>Débutant — Pas à pas (directif)</option>
  <option>Débutant — Pas à pas (socratique)</option>
</optgroup>
<optgroup label="Intermédiaire">
  <option>Intermédiaire — Commenté (directif)</option>
  <option>Intermédiaire — Commenté (socratique)</option>
</optgroup>
<optgroup label="Avancé / Expert">
  <option>Expert — Succinct (directif)</option>
  <option>Expert — Succinct (socratique)</option>
</optgroup>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
        <label class="flex items-center"><input id="dev-file-tree" type="checkbox" class="h-4 w-4 rounded"><span class="ml-2">Inclure l'arborescence des fichiers</span></label>
        <label class="flex items-center"><input id="dev-instructions" type="checkbox" class="h-4 w-4 rounded"><span class="ml-2">Inclure les commandes d'installation & exécution</span></label>
        <label class="flex items-center"><input id="dev-tests" type="checkbox" class="h-4 w-4 rounded"><span class="ml-2">Inclure des tests</span></label>
        <label class="flex items-center"><input id="dev-step-by-step" type="checkbox" class="h-4 w-4 rounded"><span class="ml-2">Raisonnement étape par étape</span></label>
        <label class="flex items-center"><input id="dev-ready-code" type="checkbox" class="h-4 w-4 rounded" checked><span class="ml-2">Code prêt à copier-coller</span></label>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700" for="dev-test-frameworks">Tests : frameworks / critères</label>
          <input id="dev-test-frameworks" class="mt-1 block w-full rounded-md border-gray-300" placeholder="pytest, JUnit, Vitest, 80% coverage…"/>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700" for="dev-response-lang">Langue de la réponse</label>
          <select id="dev-response-lang" class="mt-1 block w-full rounded-md border-gray-300">
            <option>Français</option>
            <option>Anglais</option>
            <option>Espagnol</option>
            <option>Allemand</option>
            <option>Italien</option>
            <option>Portugais</option>
            <option>Néerlandais</option>
            <option>Polonais</option>
            <option>Arabe</option>
            <option>Chinois (simplifié)</option>
            <option>Japonais</option>
            <option>Coréen</option>
          </select>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700" for="dev-existing-code">Code existant à prendre en compte (optionnel)</label>
        <textarea id="dev-existing-code" rows="4" class="mt-1 block w-full rounded-md border-gray-300" placeholder="Collez un extrait ou décrivez brièvement ce qui existe déjà."></textarea>
      </div>
    </div>

    <!-- Right: Preview -->
    <div>
      <div class="sticky top-20 bg-gray-100 p-6 rounded-lg shadow-inner">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">Prompt Développeur Généré</h2>
        <div class="prompt-box bg-white p-4 rounded-md text-gray-700 text-sm overflow-auto max-h-[70vh]" id="developers-preview">Remplissez les champs pour générer le prompt…</div>
        <div class="flex flex-col space-y-2 mt-4">
          <button class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700" id="developers-copy-btn">Copier le Prompt</button>
          <span class="hidden text-center text-xs text-green-600 font-medium" id="developers-copied-badge">Copié ! ✅</span>
          <button class="hidden px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors" id="developers-clear-btn">Effacer les données</button>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="fixed inset-0 bg-gray-50 z-40 p-4 md:p-8 overflow-y-auto hidden" id="settings-panel">
    <div class="container mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Paramètres</h1>
            <button class="p-2 rounded-full text-gray-500 hover:bg-gray-200 transition-colors" id="close-settings-btn"><svg class="h-6 w-6" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg></button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-lg shadow space-y-6">
                <h2 class="text-xl font-semibold">Options Personnalisées</h2>
                <div><h3 class="font-medium text-gray-700 mb-2">Rôles</h3><div class="flex flex-wrap gap-2 mb-2" id="rolesChips"></div><div class="flex space-x-2"><input class="flex-grow px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" data-type="role" id="newRole" placeholder="Nouveau rôle" type="text"/><button class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition-colors" data-add="role" id="addRole">Ajouter</button></div></div>
                <div><h3 class="font-medium text-gray-700 mb-2">Formats de sortie</h3><div class="flex flex-wrap gap-2 mb-2" id="formatChips"></div><div class="flex space-x-2"><input class="flex-grow px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" data-type="format" placeholder="Nouveau format" type="text"/><button class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition-colors" data-add="format">Ajouter</button></div></div>
                <div><h3 class="font-medium text-gray-700 mb-2">Niveaux de détail</h3><div class="flex flex-wrap gap-2 mb-2" id="detailChips"></div><div class="flex space-x-2"><input class="flex-grow px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" data-type="detail" placeholder="Nouveau niveau" type="text"/><button class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition-colors" data-add="detail">Ajouter</button></div></div>
                <div><h3 class="font-medium text-gray-700 mb-2">Tons</h3><div class="flex flex-wrap gap-2 mb-2" id="toneChips"></div><div class="flex space-x-2"><input class="flex-grow px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" data-type="tone" placeholder="Nouveau ton" type="text"/><button class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition-colors" data-add="tone">Ajouter</button></div></div>
                <div><h3 class="font-medium text-gray-700 mb-2">Langues</h3><div class="flex flex-wrap gap-2 mb-2" id="langChips"></div><div class="flex space-x-2"><input class="flex-grow px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" data-type="lang" placeholder="Nouvelle langue" type="text"/><button class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition-colors" data-add="lang">Ajouter</button></div></div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow space-y-6">
                <h2 class="text-xl font-semibold">Domaines Personnalisés</h2>
                <div class="flex flex-wrap gap-2 mb-2" id="domainChips"></div>
                <div>
                    <h3 class="font-medium text-gray-700 mb-2">Ajouter un nouveau domaine</h3>
                    <label class="block text-sm font-medium text-gray-700" for="newDomainName">Nom du domaine</label><input class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="newDomainName" placeholder="Ex: Finance, Marketing..." type="text"/>
                    <label class="block text-sm font-medium text-gray-700 mt-4" for="newDomainTasks">Tâches fréquentes (une par ligne)</label><textarea class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" id="newDomainTasks" rows="3"></textarea>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="newDomainRisks" type="checkbox"/><span class="ml-2">Risques</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="newDomainCosts" type="checkbox"/><span class="ml-2">Coûts</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="newDomainKpi" type="checkbox"/><span class="ml-2">KPI</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="newDomainDeps" type="checkbox"/><span class="ml-2">Dépendances</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="newDomainLimits" type="checkbox"/><span class="ml-2">Limites</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="newDomainSources" type="checkbox"/><span class="ml-2">Sources</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="newDomainAllowUnknown" type="checkbox"/><span class="ml-2">"Je ne sais pas"</span></label>
                        <label class="flex items-center"><input class="h-4 w-4 text-indigo-600 rounded" id="newDomainListUnknowns" type="checkbox"/><span class="ml-2">Lister inconnues</span></label>
                    </div>
                    <button class="mt-4 w-full px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 transition-colors" id="addDomain">Ajouter ce domaine</button>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow space-y-6">
                <h2 class="text-xl font-semibold">Paramètres Visuels</h2>
                <div>
                    <label class="block text-sm font-medium text-gray-700" for="bgColor">Couleur de fond</label>
                    <div class="flex space-x-2 mt-1"><input class="h-10 w-10 p-1 rounded-md border border-gray-300" id="bgColor" type="color" value="#f9fafb"/><button class="px-3 py-1 text-sm text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors" id="resetBgColor">Réinitialiser</button></div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700" for="bgImageFile">Image de fond</label>
                    <div class="flex space-x-2 mt-1"><input accept="image/*" class="text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" id="bgImageFile" type="file"/><button class="hidden px-3 py-1 text-sm text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors" id="removeBgImage">Supprimer</button></div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700" for="titleColor">Couleur du titre</label>
                    <div class="flex space-x-2 mt-1"><input class="h-10 w-10 p-1 rounded-md border border-gray-300" id="titleColor" type="color" value="#1f2937"/><button class="px-3 py-1 text-sm text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors" id="resetTitleColor">Réinitialiser</button></div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700" for="logoFile">Logo</label>
                    <div class="flex space-x-2 mt-1 items-center"><input accept="image/*" class="text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" id="logoFile" type="file"/><button class="hidden px-3 py-1 text-sm text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors" id="remove-logo">Supprimer</button></div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow space-y-4">
                <h2 class="text-xl font-semibold">Sauvegarde &amp; Restauration</h2>
                <div class="flex flex-col space-y-2">
                    <button class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors" id="exportBtn">Exporter la configuration</button>
                    <label class="flex-grow px-4 py-2 text-sm font-medium text-center text-blue-600 bg-blue-100 rounded-md hover:bg-blue-200 transition-colors cursor-pointer" for="importFile">Importer une configuration</label>
                    <input accept=".json" class="hidden" id="importFile" type="file"/>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const DEFAULT_LOGO = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAABRCAYAAACi2dYkAAAACXBIWXMAAAsTAAALEwEAmpwYAAADwUlEQVR4nO2bv0oEQRTHf16y9wQ7Q+wJbMv2BHaE2BPaEwQRS3hL7J1oQax8E3sJ+wE22FqYhYVs9s5lV683s92d3Z3N7vvgwN58b/Z8M5vNdm8YhmEYhmEYhmEYhmEYhmEYhmEYhmEYhmEYhmEYhmGYA4rW6/UGp/v5eZk2j8drg8f29vbL1j/Q+B6v1+u+x+12OxwMBr4EAK/Hk8P462/o+fCjYt6+vj6L+f+g58OPxnz/8+94HwD+f/h+f3H1eH+r2e293W1e/f7rVnsPqP8D2B/B/gD2j8L/B+2uNqj9gNrvD6i+gOjvD6D1B9gPoD+F3g+g/QfUD6D9H62/r+sP+o3Wf7n/3+n8n6f9b/h/h/h/7/Hfr/P/3/j/p/w/4fTP9T8f8A+B/AfgD8H8B+APxLof8B9Ifh/gH0h8B+APRD0A9CPQj1JtQTUL8H9SfQH0J9CPQh1JtAHQj1JtD/B+h/QPoPUP8H0P8H0P8D0N8D+v/Q/gPoF9gvoJ9AvQP1CehPoH4B9UnoT6B+APWJ6E+gPoH6BOpPof4H6A+g/gD1R+j/X6wPoH4A9UfoB6AfoH4B+gHoB6AfoB+A/gD6AegHoB+A/gD6AegnoJ6AegLqD1h/QH1B9QHUH1AfgJ+AHgLqD6A/gC4A/f+g/wG6AuAH/6+pPwD9/2j/I+m+I/lP2A+g/4B0A/gA/gPqA/APoD+A+gPoD6B/AX0A+gPoC6B/APoB9BvQZ0GdAnQF1CtQPUGdAnQF1BdQXUFdAXQF1AtQJUCdAnQJ1DdQTUG9AvQF1BfQTUG9AHUF9ANwA9APQHUAPADUAfQDwAVAHQD8AdAPQD0A/AHwA+AHQA9AdgA5AdwA6ANgB0w+A3QBwA8AdAHeD2G9A9APQD0w/AH4A+gHoB6AeQHYA2wPoB6IfgB6AegH4AegHwA9APQD0A+gHQD8A9APQD0A/AHwA+AHYA+AHYD8A9gPQD8AegH8A+gPoA9A/AD4A/APoD6A/APgD6APQJgP4B8A+gXwB8AvQJ0CdAHwD7AegTUCdAewD6APQHoJ0B9QHoD6BfAHoD+APoD6A/AOgPQJ0B6A8A+gPQP+E+B/d6g+C/3rD8I+G+A3wB/gHoF7/jLgAAAABJRU5kJggg==";

    const els = {
        homePanel: document.getElementById("home-panel"),
        promptBuilderPanel: document.getElementById("prompt-builder-panel"),
        settingsPanel: document.getElementById("settings-panel"),
        summaryAssistantPanel: document.getElementById("summary-assistant-panel"),
        guidedAssistantPanel: document.getElementById("guided-assistant-panel"),
        
        homeBtn: document.getElementById("home-btn"),
        settingsBtn: document.getElementById("settings-btn"),
        closeSettingsBtn: document.getElementById("close-settings-btn"),
        
        preview: document.getElementById("preview"),
        copyBtn: document.getElementById("copy-btn"),
        copiedBadge: document.getElementById("copied-badge"),
        clearBtn: document.getElementById("clear-btn"),
        exportBtn: document.getElementById("exportBtn"),
        importFile: document.getElementById("importFile"),
        mainTitle: document.getElementById("mainTitle"),
        company: document.getElementById("company"),
        sector: document.getElementById("sector"),
        audience: document.getElementById("audience"),
        goals: document.getElementById("goals"),
        constraints: document.getElementById("constraints"),
        deadline: document.getElementById("deadline"),
        domain: document.getElementById("domain"),
        role: document.getElementById("role"),
        format: document.getElementById("format"),
        detail: document.getElementById("detail"),
        tone: document.getElementById("tone"),
        lang: document.getElementById("lang"),
        task: document.getElementById("task"),
        acceptance: document.getElementById("acceptance"),
        examples: document.getElementById("examples"),
        length: document.getElementById("length"),
        risks: document.getElementById("risks"),
        costs: document.getElementById("costs"),
        kpi: document.getElementById("kpi"),
        deps: document.getElementById("deps"),
        limits: document.getElementById("limits"),
        sources: document.getElementById("sources"),
        allowUnknown: document.getElementById("allowUnknown"),
        listUnknowns: document.getElementById("listUnknowns"),
        teamMode: document.getElementById("teamMode"),
        team: document.getElementById("team"),
        teamSection: document.getElementById("team-section"),
        teamAdds: document.getElementById("team-adds"),
        chainOfThought: document.getElementById("chainOfThought"),
        genKnowledge: document.getElementById("genKnowledge"),
        knowledgeSubject: document.getElementById("knowledgeSubject"),
        genKnowledgeFields: document.getElementById("genKnowledgeFields"),
        selfReflection: document.getElementById("selfReflection"),
        newRole: document.getElementById("newRole"),
        rolesChips: document.getElementById("rolesChips"),
        addRole: document.getElementById("addRole"),
        bgColor: document.getElementById("bgColor"),
        resetBgColor: document.getElementById("resetBgColor"),
        bgImageFile: document.getElementById("bgImageFile"),
        removeBgImage: document.getElementById("removeBgImage"),
        titleColor: document.getElementById("titleColor"),
        resetTitleColor: document.getElementById("resetTitleColor"),
        logoFile: document.getElementById("logoFile"),
        logoPreview: document.getElementById("logo-preview"),
        logoContainer: document.getElementById("logo-container"),
        removeLogo: document.getElementById("remove-logo"),
        modalOverlay: document.getElementById("modal-overlay"),
        modalTitle: document.getElementById("modal-title"),
        modalText: document.getElementById("modal-text"),
        modalConfirm: document.getElementById("modal-confirm"),
        modalCancel: document.getElementById("modal-cancel"),
        newDomainName: document.getElementById("newDomainName"),
        newDomainTasks: document.getElementById("newDomainTasks"),
        newDomainRisks: document.getElementById("newDomainRisks"),
        newDomainCosts: document.getElementById("newDomainCosts"),
        newDomainKpi: document.getElementById("newDomainKpi"),
        newDomainDeps: document.getElementById("newDomainDeps"),
        newDomainLimits: document.getElementById("newDomainLimits"),
        newDomainSources: document.getElementById("newDomainSources"),
        newDomainAllowUnknown: document.getElementById("newDomainAllowUnknown"),
        newDomainListUnknowns: document.getElementById("newDomainListUnknowns"),
        addDomain: document.getElementById("addDomain"),
        domainChips: document.getElementById("domainChips"),
        quickTasks: document.getElementById("quick-tasks"),
        
        summaryPreview: document.getElementById("summary-preview"),
        summaryCopyBtn: document.getElementById("summary-copy-btn"),
        summaryCopiedBadge: document.getElementById("summary-copied-badge"),
        summaryContextType: document.getElementById('summaryContextType'),
        summaryContextAudience: document.getElementById('summaryContextAudience'),
        summaryContextObjective: document.getElementById('summaryContextObjective'),
        summaryFormatType: document.getElementById('summaryFormatType'),
        summaryFormatDetail: document.getElementById('summaryFormatDetail'),
        summaryStructureBullets: document.getElementById('summaryStructureBullets'),
        summaryStructureParagraphs: document.getElementById('summaryStructureParagraphs'),
        summaryStructurePlan: document.getElementById('summaryStructurePlan'),
        summaryStructureTable: document.getElementById('summaryStructureTable'),
        summaryStyleTone: document.getElementById('summaryStyleTone'),
        summaryStyleComplexity: document.getElementById('summaryStyleComplexity'),
        summaryStyleVoice: document.getElementById('summaryStyleVoice'),
        summaryAngleIdeas: document.getElementById('summaryAngleIdeas'),
        summaryAngleArgs: document.getElementById('summaryAngleArgs'),
        summaryAngleFacts: document.getElementById('summaryAngleFacts'),
        summaryAngleQuotes: document.getElementById('summaryAngleQuotes'),
        summaryAngleContext: document.getElementById('summaryAngleContext'),
        summaryAngleDefs: document.getElementById('summaryAngleDefs'),
        summaryAngleLinks: document.getElementById('summaryAngleLinks'),
        summaryAnalysisStrengths: document.getElementById('summaryAnalysisStrengths'),
        summaryAnalysisImplications: document.getElementById('summaryAnalysisImplications'),
        summaryAnalysisQuestions: document.getElementById('summaryAnalysisQuestions'),
        summaryAnalysisCompare: document.getElementById('summaryAnalysisCompare'),
        summaryConstraintLength: document.getElementById('summaryConstraintLength'),
        summaryConstraintOmit: document.getElementById('summaryConstraintOmit'),
        summaryConstraintTitles: document.getElementById('summaryConstraintTitles'),
        summaryConstraintBold: document.getElementById('summaryConstraintBold'),

        guidedPreview: document.getElementById("guided-preview"),
        guidedCopyBtn: document.getElementById("guided-copy-btn"),
        guidedCopiedBadge: document.getElementById("guided-copied-badge"),
        guidedClearBtn: document.getElementById("guided-clear-btn"),
        guidedWho: document.getElementById('guidedWho'),
        guidedWhy: document.getElementById('guidedWhy'),
        guidedDomain: document.getElementById('guidedDomain'),
        guidedResponseType: document.getElementById('guidedResponseType'),
        guidedFormat: document.getElementById('guidedFormat'),
        guidedStyle: document.getElementById('guidedStyle'),
        guidedLength: document.getElementById('guidedLength'),
        guidedLanguageLevel: document.getElementById('guidedLanguageLevel'),
        guidedExamples: document.getElementById('guidedExamples'),
        guidedInclude: document.getElementById('guidedInclude'),
        guidedExclude: document.getElementById('guidedExclude'),
        guidedAdvancedCOT: document.getElementById('guidedAdvancedCOT'),
        guidedAdvancedKnowledge: document.getElementById('guidedAdvancedKnowledge'),
        guidedAdvancedSelfReflect: document.getElementById('guidedAdvancedSelfReflect'),
        guidedMainRequest: document.getElementById('guidedMainRequest'),

        // Nouveaux assistants
        assistantInfoPanel: document.getElementById('assistant-info-panel'),
        infoTask: document.getElementById('info-task'),
        infoPreview: document.getElementById('info-preview'),
        assistantCreationPanel: document.getElementById('assistant-creation-panel'),
        creationTask: document.getElementById('creation-task'),
        creationPreview: document.getElementById('creation-preview'),
        assistantAnalysisPanel: document.getElementById('assistant-analysis-panel'),
        analysisTask: document.getElementById('analysis-task'),
        analysisPreview: document.getElementById('analysis-preview'),
        assistantProblemPanel: document.getElementById('assistant-problem-panel'),
        problemTask: document.getElementById('problem-task'),
        problemPreview: document.getElementById('problem-preview'),
        assistantTrainingPanel: document.getElementById('assistant-training-panel'),
        trainingTask: document.getElementById('training-task'),
        trainingPreview: document.getElementById('training-preview'),
        assistantOrganizationPanel: document.getElementById('assistant-organization-panel'),
        organizationTask: document.getElementById('organization-task'),
        organizationPreview: document.getElementById('organization-preview'),
        assistantSimulationPanel: document.getElementById('assistant-simulation-panel'),
        simulationTask: document.getElementById('simulation-task'),
        simulationPreview: document.getElementById('simulation-preview'),
    
// --- Développeurs ---
assistantDevelopersPanel: document.getElementById("assistant-developers-panel"),
developersPreview: document.getElementById("developers-preview"),
developersCopyBtn: document.getElementById("developers-copy-btn"),
developersCopiedBadge: document.getElementById("developers-copied-badge"),
devRequestType: document.getElementById("dev-request-type"),
devLanguages: document.getElementById("dev-languages"),
devEnv: document.getElementById("dev-env"),
devContext: document.getElementById("dev-context"),
devSpecs: document.getElementById("dev-specs"),
devInputs: document.getElementById("dev-inputs"),
devEdgeCases: document.getElementById("dev-edge-cases"),
devConstraints: document.getElementById("dev-constraints"),
devOutputType: document.getElementById("dev-output-type"),
devExplainLevel: document.getElementById("dev-explain-level"),
devFileTree: document.getElementById("dev-file-tree"),
devInstructions: document.getElementById("dev-instructions"),
devTests: document.getElementById("dev-tests"),
devTestFrameworks: document.getElementById("dev-test-frameworks"),
devResponseLang: document.getElementById("dev-response-lang"),
devReadyCode: document.getElementById("dev-ready-code"),
devStepByStep: document.getElementById("dev-step-by-step"),
};

    const DATA = {
        defaultRoles: [
            "Expert en gestion de projet", "Chef de produit", "Architecte logiciel", "Spécialiste en cybersécurité",
            "Analyste de données", "Consultant en stratégie d'entreprise", "Rédacteur technique", "Marketeur digital"
        ],
        outputFormats: [
            { value: "bullet-points", label: "Liste à puces" },
            { value: "markdown", label: "Document Markdown structuré" },
            { value: "email", label: "Brouillon d'email" },
            { value: "slide-deck", label: "Plan de diapositives (Slide deck)" },
            { value: "table", label: "Tableau de données" }
        ],
        detailLevels: [
            { value: "low", label: "Synthétique (1-2 paragraphes)" },
            { value: "medium", label: "Détaillé (sections structurées)" },
            { value: "high", label: "Exhaustif (incluant toutes les sections pertinentes)" }
        ],
        tones: [
            { value: "professional", label: "Professionnel et formel" },
            { value: "friendly", label: "Amical et accessible" },
            { value: "technical", label: "Technique et précis" },
            { value: "persuasive", label: "Persuasif et engageant" }
        ],
        languages: [
            { value: "fr", label: "Français" },
            { value: "en", label: "Anglais" },
            { value: "es", label: "Espagnol" }
        ],
        domainPresets: {
            "Gestion de projet": {
                tasks: ["Créer un plan de projet", "Rédiger un cahier des charges", "Analyser les risques", "Préparer une réunion de lancement"],
                toggles: { risks: true, kpi: true, deps: true }
            },
            "Développement logiciel": {
                tasks: ["Décrire une architecture logicielle", "Rédiger les spécifications d'une API", "Planifier un sprint", "Définir des cas de test"],
                toggles: { risks: true, deps: true, limits: true, sources: true }
            },
            "Cybersécurité": {
                tasks: ["Réaliser une analyse des menaces", "Créer une politique de sécurité", "Rédiger un rapport de vulnérabilité"],
                toggles: { risks: true, limits: true, listUnknowns: true }
            }
        },
        teamProfiles: [
            { value: "dev", label: "Développeurs", adds: ["Utiliser un ton technique.", "Inclure des exemples de code si pertinent.", "Se concentrer sur les aspects techniques."] },
            { value: "biz", label: "Business", adds: ["Utiliser un ton orienté business.", "Se concentrer sur l'impact financier et les bénéfices.", "Éviter le jargon technique."] },
            { value: "mkt", label: "Marketing", adds: ["Utiliser un ton créatif et persuasif.", "Mettre l'accent sur les avantages pour le client.", "Présenter l'information de manière visuelle."] }
        ],
        guidedWhoOptions: ["Étudiant", "Expert", "Manager", "Enseignant", "Débutant", "Curieux", "Utilisateur non-technique"],
        guidedWhyOptions: ["Apprendre et comprendre", "Prendre une décision", "Comparer des options", "Résoudre un problème concret", "M'entraîner sur un sujet", "Trouver des idées"],
        guidedDomainOptions: ["Science", "Technique / Informatique", "Business / Entreprise", "Marketing", "Littérature / Arts", "Histoire", "Développement Personnel"],
        guidedFormatOptions: ["Liste à puces (bullet points)", "Texte rédigé en paragraphes", "Tableau comparatif", "Plan détaillé (I, A, 1, a)", "Schéma conceptuel (décrit textuellement)", "Liste numérotée", "FAQ (Foire Aux Questions)"],
        guidedStyleOptions: ["Pédagogique et simple", "Académique et formel", "Vulgarisé et accessible", "Concret avec des exemples", "Créatif et original", "Professionnel et direct"],
        guidedLanguageLevelOptions: ["Simple (pour un enfant de 10 ans)", "Clair (pour un lycéen)", "Standard (pour un adulte)", "Professionnel (pour un collègue)", "Expert (pour un doctorant)"]
    };

    const getLS = (key, def) => { try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : def; } catch { return def; } };
    const setLS = (key, v) => { try { localStorage.setItem(key, JSON.stringify(v)); } catch {} };

    const fillOptions = (sel, options) => {
        if (!sel || !options || options.length === 0) return;
        if (typeof options[0] === 'object' && options[0] !== null && options[0].hasOwnProperty('value')) {
            sel.innerHTML = options.map(o => `<option value="${o.value}">${o.label}</option>`).join('');
        } else {
            sel.innerHTML = options.map(o => `<option value="${o}">${o}</option>`).join('');
        }
    };

    const loadValue = (elem, key, def) => {
        const value = getLS(key, def);
        if (elem) {
            if (elem.type === "checkbox") {
                elem.checked = value;
            } else {
                elem.value = value;
            }
        }
    };
    
    const handleAccordion = () => {
        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                const icon = header.querySelector('svg');
                content.classList.toggle('active');
                icon.classList.toggle('rotate-180');
            });
        });
    };

    const createOptionManager = (type, defaultData, selectEl, inputEl, chipsEl, addBtnEl) => {
        let options = getLS(`dsi_custom_${type}`, []);
        const allOptions = () => [...defaultData, ...options.map(o => ({ value: o, label: o }))];

        const refresh = () => {
            fillOptions(selectEl, allOptions());
            chipsEl.innerHTML = options.map(o =>
                `<span class="chip">${o} <button title="Supprimer" data-option="${o}" class="text-gray-400 hover:text-red-600 transition-colors">✕</button></span>`
            ).join('');

            chipsEl.querySelectorAll("button[data-option]").forEach(btn => {
                btn.addEventListener("click", () => {
                    const optionToRemove = btn.getAttribute("data-option");
                    options = options.filter(o => o !== optionToRemove);
                    setLS(`dsi_custom_${type}`, options);
                    refresh();
                    updatePreview();
                });
            });
        };

        const add = () => {
            const newOptionText = inputEl.value.trim();
            if (newOptionText && !allOptions().some(o => o.value === newOptionText)) {
                options.push(newOptionText);
                setLS(`dsi_custom_${type}`, options);
                inputEl.value = "";
                refresh();
                updatePreview();
            }
        };

        if (addBtnEl) {
            addBtnEl.addEventListener("click", add);
            inputEl.addEventListener("keydown", (e) => {
                if (e.key === "Enter") {
                    e.preventDefault();
                    add();
                }
            });
        }
        return { refresh, add };
    };

    const domainManager = (() => {
        let customDomains = getLS("dsi_custom_domains", {});
        
        const getDomainPresets = () => {
            const allPresets = { ...DATA.domainPresets };
            Object.entries(customDomains).forEach(([key, value]) => {
                allPresets[key] = value;
            });
            return allPresets;
        };

        const refresh = () => {
            const allPresets = getDomainPresets();
            fillOptions(els.domain, Object.keys(allPresets).map(k => ({ value: k, label: k })));
            
            els.domainChips.innerHTML = Object.keys(customDomains).map(d =>
                `<span class="chip">${d} <button title="Supprimer le domaine" data-domain="${d}" class="text-gray-400 hover:text-red-600 transition-colors">✕</button></span>`
            ).join('');

            els.domainChips.querySelectorAll("button[data-domain]").forEach(btn => {
                btn.addEventListener("click", () => {
                    const domainToRemove = btn.getAttribute("data-domain");
                    delete customDomains[domainToRemove];
                    setLS("dsi_custom_domains", customDomains);
                    refresh();
                });
            });
        };

        const add = () => {
            const name = els.newDomainName.value.trim();
            if (!name) return;

            const newDomain = {
                tasks: els.newDomainTasks.value.split('\n').map(t => t.trim()).filter(t => t),
                toggles: {
                    risks: els.newDomainRisks.checked, costs: els.newDomainCosts.checked,
                    kpi: els.newDomainKpi.checked, deps: els.newDomainDeps.checked,
                    limits: els.newDomainLimits.checked, sources: els.newDomainSources.checked,
                    allowUnknown: els.newDomainAllowUnknown.checked, listUnknowns: els.newDomainListUnknowns.checked
                }
            };

            customDomains[name] = newDomain;
            setLS("dsi_custom_domains", customDomains);
            
            els.newDomainName.value = "";
            els.newDomainTasks.value = "";
            const toggles = [els.newDomainRisks, els.newDomainCosts, els.newDomainKpi, els.newDomainDeps, els.newDomainLimits, els.newDomainSources, els.newDomainAllowUnknown, els.newDomainListUnknowns];
            toggles.forEach(t => t.checked = false);
            refresh();
        };

        return { refresh, add, getDomainPresets };
    })();
    
    const roleManager = createOptionManager('role', DATA.defaultRoles.map(r => ({ value: r, label: r })), els.role, els.newRole, els.rolesChips, els.addRole);
    const formatManager = createOptionManager('format', DATA.outputFormats, els.format, document.querySelector('input[data-type="format"]'), document.getElementById('formatChips'), document.querySelector('button[data-add="format"]'));
    const detailManager = createOptionManager('detail', DATA.detailLevels, els.detail, document.querySelector('input[data-type="detail"]'), document.getElementById('detailChips'), document.querySelector('button[data-add="detail"]'));
    const toneManager = createOptionManager('tone', DATA.tones, els.tone, document.querySelector('input[data-type="tone"]'), document.getElementById('toneChips'), document.querySelector('button[data-add="tone"]'));
    const langManager = createOptionManager('lang', DATA.languages, els.lang, document.querySelector('input[data-type="lang"]'), document.getElementById('langChips'), document.querySelector('button[data-add="lang"]'));

    const renderQuickTasks = () => {
        const presets = domainManager.getDomainPresets();
        const tasks = presets[els.domain.value]?.tasks || [];
        els.quickTasks.innerHTML = tasks.map(qt =>
            `<button class="text-xs px-3 py-1 rounded-full bg-indigo-50 text-indigo-700 hover:bg-indigo-100 transition-colors">${qt}</button>`
        ).join('');
        els.quickTasks.querySelectorAll('button').forEach(btn => {
            btn.addEventListener("click", () => {
                els.task.value = btn.textContent;
                setLS("dsi_task", els.task.value);
                updatePreview();
            });
        });
    };

    const renderTeamAdds = () => {
        els.teamSection.style.display = els.teamMode.checked ? "block" : "none";
        const profile = DATA.teamProfiles.find(p => p.value === els.team.value);
        els.teamAdds.innerHTML = profile?.adds?.map(a => `<li>${a}</li>`).join('') || '';
    };

    const assemblePrompt = () => {
        const promptParts = [];
        promptParts.push(`Tu es ${els.role.value}. Ta mission est de réaliser la tâche décrite en respectant strictement le format et les critères ci-dessous.`);

        if (els.genKnowledge.checked && els.knowledgeSubject.value.trim()) {
            promptParts.push(`\n<connaissances_prealables>\nRésume d'abord les éléments essentiels à propos de "${els.knowledgeSubject.value.trim()}". Ensuite, utilise ces informations pour accomplir ta mission.\n</connaissances_prealables>`);
        }
        if (els.chainOfThought.checked) {
            promptParts.push(`\n<raisonnement>\nAvant de donner ta réponse, décris ton raisonnement et les étapes que tu vas suivre pour y parvenir. Précise chaque étape en détail.\n</raisonnement>`);
        }

        const instructions = [`Sortie attendue: ${els.format.options[els.format.selectedIndex]?.text}`];
        if (els.length.value.trim()) instructions.push(`Longueur de la réponse: ${els.length.value.trim()}.`);
        instructions.push(`Rédige en ${els.lang.options[els.lang.selectedIndex]?.text}.`);
        instructions.push(`Ton: ${els.tone.options[els.tone.selectedIndex]?.text}.`);
        instructions.push(`Niveau de détail: ${els.detail.options[els.detail.selectedIndex]?.text}.`);
        
        const toggleInstructions = {
            risks: "Inclure une section Risques.", costs: "Inclure estimation des Coûts/TCO si pertinent.",
            kpi: "Inclure des KPI/mesures de succès.", deps: "Mentionner les dépendances et prérequis.",
            limits: "Indiquer les hypothèses et limites.", sources: "Fournir des sources ou références quand pertinent.",
            allowUnknown: "Si une information manque, répondre 'Je ne sais pas' plutôt que d'inventer.",
            listUnknowns: "Lister explicitement les inconnues et les questions à poser."
        };
        Object.entries(toggleInstructions).forEach(([key, value]) => {
            if (els[key]?.checked) instructions.push(value);
        });

        if (els.teamMode.checked) {
            const profile = DATA.teamProfiles.find(p => p.value === els.team.value);
            if (profile) instructions.push(...profile.adds);
        }

        const context = `Entreprise: ${els.company.value.trim()}\nSecteur: ${els.sector.value.trim()}\nAudience: ${els.audience.value.trim()}${els.teamMode.checked ? ` (adapter au public: ${els.team.options[els.team.selectedIndex]?.text})` : ""}\nObjectifs: ${els.goals.value.trim()}\nContraintes: ${els.constraints.value.trim()}\nÉchéance: ${els.deadline.value.trim()}`;
        
        promptParts.push(`\n<contexte>\n${context}\n</contexte>`);
        promptParts.push(`\n<instructions>\n${instructions.join('\n')}\n</instructions>`);

        if (els.examples.value.trim()) {
            promptParts.push(`\n<exemples_de_sortie>\n\n${els.examples.value.trim()}\n</exemples_de_sortie>`);
        }
        
        promptParts.push(`\n<criteres_acceptation>\n${els.acceptance.value}\n</criteres_acceptation>`);
        promptParts.push(`\n\`\`\`tache\n${els.task.value}\n\`\`\``);

        if (els.selfReflection.checked) {
            promptParts.push(`\n<auto_evaluation>\nAprès ta réponse, fais une auto-évaluation et indique si tu penses avoir couvert tous les points essentiels.\n</auto_evaluation>`);
        }
        return promptParts.join('\n\n');
    };

    const updatePreview = () => {
        els.preview.textContent = assemblePrompt();
    };

    const applyVisualSettings = () => {
        const bgColor = getLS("dsi_bg_color", "#f9fafb");
        const bgImage = getLS("dsi_bg_image", "");
        const titleColor = getLS("dsi_title_color", "#1f2937");
        const logo = getLS("dsi_logo", DEFAULT_LOGO);

        document.body.style.backgroundColor = bgColor;
        document.body.style.backgroundImage = bgImage ? `url(${bgImage})` : 'none';
        document.body.style.backgroundSize = 'cover';
        document.body.style.backgroundPosition = 'center';
        document.body.style.backgroundRepeat = 'no-repeat';
        els.mainTitle.style.color = titleColor;

        if (logo) {
            els.logoPreview.src = logo;
            els.logoContainer.classList.remove("hidden");
        } else {
            els.logoPreview.src = "";
            els.logoContainer.classList.add("hidden");
        }
        els.removeLogo.classList.toggle('hidden', !logo);
    };

    const showModal = (title, text, onConfirm) => {
        els.modalTitle.textContent = title;
        els.modalText.textContent = text;
        els.modalOverlay.classList.remove("hidden");
        els.modalConfirm.onclick = () => {
            els.modalOverlay.classList.add("hidden");
            onConfirm();
        };
        els.modalCancel.onclick = () => {
            els.modalOverlay.classList.add("hidden");
        };
    };
    
    const assembleSummaryPrompt = () => {
        let prompt = `Tu es un assistant expert en synthèse et analyse de documents. Ta mission est d'analyser le document que je vais téléverser séparément et d'en produire un compte rendu en suivant scrupuleusement les instructions ci-dessous.\n\n`;
        const contextItems = [];
        contextItems.push(`- Type de source : ${els.summaryContextType.value}`);
        if(els.summaryContextAudience.value) contextItems.push(`- Public cible : ${els.summaryContextAudience.value}`);
        contextItems.push(`- Objectif : ${els.summaryContextObjective.value}`);
        prompt += `<contexte>\n${contextItems.join('\n')}\n</contexte>\n\n`;
        const formatItems = [];
        formatItems.push(`- Type de sortie : ${els.summaryFormatType.value}`);
        formatItems.push(`- Niveau de détail : ${els.summaryFormatDetail.value}`);
        const structures = [];
        if(els.summaryStructureBullets.checked) structures.push('Points clés / bullet points');
        if(els.summaryStructureParagraphs.checked) structures.push('Paragraphes développés');
        if(els.summaryStructurePlan.checked) structures.push('Plan hiérarchisé (I, II, A, B...)');
        if(els.summaryStructureTable.checked) structures.push('Tableaux ou schémas si nécessaire');
        if (structures.length > 0) formatItems.push(`- Structure à utiliser : ${structures.join(', ')}`);
        prompt += `<format_attendu>\n${formatItems.join('\n')}\n</format_attendu>\n\n`;
        const styleItems = [];
        styleItems.push(`- Ton : ${els.summaryStyleTone.value}`);
        styleItems.push(`- Complexité : ${els.summaryStyleComplexity.value}`);
        styleItems.push(`- Voix : ${els.summaryStyleVoice.value}`);
        prompt += `<style_ecriture>\n${styleItems.join('\n')}\n</style_ecriture>\n\n`;
        const angleItems = [];
        const highlights = [];
        if(els.summaryAngleIdeas.checked) highlights.push('idées principales');
        if(els.summaryAngleArgs.checked) highlights.push('arguments');
        if(els.summaryAngleFacts.checked) highlights.push('faits et chiffres');
        if(els.summaryAngleQuotes.checked) highlights.push('citations marquantes');
        if(highlights.length > 0) angleItems.push(`- Mettre en avant : ${highlights.join(', ')}.`);
        const additions = [];
        if(els.summaryAngleContext.checked) additions.push('explications contextuelles');
        if(els.summaryAngleDefs.checked) additions.push('définitions des termes clés');
        if(els.summaryAngleLinks.checked) additions.push('liens logiques entre les idées');
        if(additions.length > 0) angleItems.push(`- Ajouter : ${additions.join(', ')}.`);
        if(angleItems.length > 0) prompt += `<angle_et_priorites>\n${angleItems.join('\n')}\n</angle_et_priorites>\n\n`;
        const analysisItems = [];
        if(els.summaryAnalysisStrengths.checked) analysisItems.push('- Identifier les points forts et faibles du document.');
        if(els.summaryAnalysisImplications.checked) analysisItems.push('- Relever les implications, enjeux et conséquences des idées présentées.');
        if(els.summaryAnalysisQuestions.checked) analysisItems.push('- Dégager les questions ouvertes ou les controverses soulevées.');
        if(els.summaryAnalysisCompare.checked) analysisItems.push("- Comparer les informations avec d'autres sources ou théories si pertinent.");
        if(analysisItems.length > 0) prompt += `<analyse_et_enrichissement>\n${analysisItems.join('\n')}\n</analyse_et_enrichissement>\n\n`;
        const constraintItems = [];
        if(els.summaryConstraintLength.value) constraintItems.push(`- Longueur maximale : ${els.summaryConstraintLength.value}`);
        if(els.summaryConstraintOmit.value) constraintItems.push(`- Exclure explicitement : ${els.summaryConstraintOmit.value}`);
        const highlightsFormatting = [];
        if(els.summaryConstraintTitles.checked) highlightsFormatting.push('titres et sous-titres');
        if(els.summaryConstraintBold.checked) highlightsFormatting.push('mise en gras des termes importants');
        if(highlightsFormatting.length > 0) constraintItems.push(`- Mise en valeur : utiliser ${highlightsFormatting.join(' et ')}.`);
        if(constraintItems.length > 0) prompt += `<contraintes_formelles>\n${constraintItems.join('\n')}\n</contraintes_formelles>\n\n`;
        prompt += "Attends que je téléverse le fichier avant de commencer la tâche.";
        return prompt;
    };

    const updateSummaryPreview = () => {
        els.summaryPreview.textContent = assembleSummaryPrompt();
    };

    const assembleGuidedPrompt = () => {
        const mainRequest = els.guidedMainRequest.value.trim();
        if (!mainRequest) return "Veuillez entrer votre demande principale dans la case 'Votre Demande'.";

        const parts = [els.guidedResponseType.value, `"${mainRequest}".`];
        const context = `Je suis ${els.guidedWho.value || 'un utilisateur'} et mon objectif est de ${els.guidedWhy.value || 'mieux comprendre ce sujet'} dans le domaine de ${els.guidedDomain.value || 'général'}.`;
        parts.push(context);

        const constraints = [];
        if (els.guidedFormat.value) constraints.push(`Le format de la réponse doit être : ${els.guidedFormat.value}.`);
        if (els.guidedStyle.value) constraints.push(`Le style doit être ${els.guidedStyle.value}.`);
        if (els.guidedLength.value.trim()) constraints.push(`La longueur ne doit pas dépasser ${els.guidedLength.value.trim()}.`);
        if (els.guidedLanguageLevel.value) constraints.push(`Utilise un niveau de langage adapté à : ${els.guidedLanguageLevel.value}.`);
        if (els.guidedExamples.checked) constraints.push("Chaque point important doit être illustré par un exemple concret.");
        
        if (constraints.length > 0) parts.push("\n### Contraintes\n" + constraints.join("\n"));

        if (els.guidedInclude.value.trim()) parts.push(`\n### À inclure impérativement\n- ${els.guidedInclude.value.trim().replace(/\n/g, '\n- ')}`);
        if (els.guidedExclude.value.trim()) parts.push(`\n### À exclure\n- ${els.guidedExclude.value.trim().replace(/\n/g, '\n- ')}`);

        const advanced = [];
        if (els.guidedAdvancedCOT.checked) advanced.push("Avant de répondre, expose ton raisonnement étape par étape.");
        if (els.guidedAdvancedKnowledge.checked) advanced.push("Commence par une section 'Connaissances de base' listant les faits pertinents.");
        if (els.guidedAdvancedSelfReflect.checked) advanced.push("Termine par une section 'Auto-vérification' pour valider la qualité de ta réponse.");

        if (advanced.length > 0) parts.push("\n### Instructions avancées\n" + advanced.join("\n"));
        
        return parts.join("\n\n");
    };

    const updateGuidedPreview = () => {
        els.guidedPreview.textContent = assembleGuidedPrompt();
    };

    // Logique pour les 7 nouveaux assistants
    const assembleSimpleAssistantPrompt = (title, task) => {
        if (!task.trim()) return "Veuillez décrire votre demande.";
        return `Tu es un assistant expert en "${title}". Ta mission est de répondre à la demande suivante :\n\n"${task.trim()}"`;
    };

    const updateInfoPreview = () => els.infoPreview.textContent = assembleSimpleAssistantPrompt("Information et Compréhension", els.infoTask.value);
    const updateCreationPreview = () => els.creationPreview.textContent = assembleSimpleAssistantPrompt("Production et Création de contenu", els.creationTask.value);
    const updateAnalysisPreview = () => els.analysisPreview.textContent = assembleSimpleAssistantPrompt("Analyse et Structuration", els.analysisTask.value);
    const updateProblemPreview = () => els.problemPreview.textContent = assembleSimpleAssistantPrompt("Résolution de Problèmes", els.problemTask.value);
    const updateTrainingPreview = () => els.trainingPreview.textContent = assembleSimpleAssistantPrompt("Apprentissage et Entraînement", els.trainingTask.value);
    const updateOrganizationPreview = () => els.organizationPreview.textContent = assembleSimpleAssistantPrompt("Organisation et Productivité", els.organizationTask.value);
    const updateSimulationPreview = () => els.simulationPreview.textContent = assembleSimpleAssistantPrompt("Interaction et Dialogue Simulé", els.simulationTask.value);


    const init = () => {
        const allPanels = [
            els.homePanel, els.promptBuilderPanel, els.settingsPanel, els.summaryAssistantPanel, els.guidedAssistantPanel,
            els.assistantInfoPanel, els.assistantCreationPanel, els.assistantAnalysisPanel, els.assistantProblemPanel,
            els.assistantTrainingPanel, els.assistantOrganizationPanel, els.assistantSimulationPanel
        , els.assistantDevelopersPanel];

        const showPanel = (panelToShow) => {
            allPanels.forEach(p => p.classList.add('hidden'));
            if (panelToShow) {
                panelToShow.classList.remove('hidden');
            }
            // Affiche le bouton "Accueil" si on n'est pas sur la page d'accueil
            els.homeBtn.classList.toggle('hidden', panelToShow === els.homePanel || panelToShow === els.settingsPanel);
if (els.guidedClearBtn) {
    els.guidedClearBtn.addEventListener('click', () => {
        showModal("Effacer les données", "Ceci va effacer toutes les entrées de l'Assistant Guidé. Continuer ?", () => {
            const fields = [
                els.guidedWho, els.guidedWhy, els.guidedDomain, els.guidedResponseType, els.guidedFormat,
                els.guidedStyle, els.guidedLength, els.guidedLanguageLevel, els.guidedExamples,
                els.guidedInclude, els.guidedExclude, els.guidedMainRequest
            ];
            fields.forEach(f => { if (!f) return; if (f.tagName === 'SELECT') f.selectedIndex = 0; else f.value = ''; });
            if (els.guidedAdvancedCOT) els.guidedAdvancedCOT.checked = false;
            if (els.guidedAdvancedKnowledge) els.guidedAdvancedKnowledge.checked = false;
            if (els.guidedAdvancedSelfReflect) els.guidedAdvancedSelfReflect.checked = false;
            if (typeof updateGuidedPreview === 'function') updateGuidedPreview();
        });
    });
}

        };
        
        handleAccordion();

        domainManager.refresh();
        roleManager.refresh();
        formatManager.refresh();
        detailManager.refresh();
        toneManager.refresh();
        langManager.refresh();
        fillOptions(els.team, DATA.teamProfiles);
        
        fillOptions(els.guidedWho, DATA.guidedWhoOptions);
        fillOptions(els.guidedWhy, DATA.guidedWhyOptions);
        fillOptions(els.guidedDomain, DATA.guidedDomainOptions);
        fillOptions(els.guidedFormat, DATA.guidedFormatOptions);
        fillOptions(els.guidedStyle, DATA.guidedStyleOptions);
        fillOptions(els.guidedLanguageLevel, DATA.guidedLanguageLevelOptions);


        const persistenceMap = {
            company: "dsi_company", sector: "dsi_sector", audience: "dsi_audience",
            goals: "dsi_goals", constraints: "dsi_constraints", deadline: "dsi_deadline",
            domain: "dsi_domain", role: "dsi_role", format: "dsi_format", detail: "dsi_detail",
            tone: "dsi_tone", lang: "dsi_lang", task: "dsi_task",
            acceptance: "dsi_acceptance", examples: "dsi_examples",
            risks: "dsi_risks", costs: "dsi_costs", kpi: "dsi_kpi", deps: "dsi_deps",
            limits: "dsi_limits", sources: "dsi_sources", allowUnknown: "dsi_allowUnknown",
            listUnknowns: "dsi_listUnknowns", teamMode: "dsi_teamMode", team: "dsi_team",
            length: "dsi_length", chainOfThought: "dsi_chainOfThought", genKnowledge: "dsi_genKnowledge",
            knowledgeSubject: "dsi_knowledgeSubject", selfReflection: "dsi_selfReflection",
        };

        Object.entries(persistenceMap).forEach(([elKey, lsKey]) => {
            loadValue(els[elKey], lsKey, els[elKey]?.value);
        });
        applyVisualSettings();

        Object.values(els).forEach(elem => {
            if (elem && (elem.tagName === 'INPUT' || elem.tagName === 'SELECT' || elem.tagName === 'TEXTAREA') && !elem.hasAttribute('data-type')) {
                const eventType = (elem.tagName === 'INPUT' && elem.type !== 'checkbox') || elem.tagName === 'TEXTAREA' ? 'input' : 'change';
                elem.addEventListener(eventType, () => {
                    const key = Object.keys(els).find(k => els[k] === elem);
                    if (persistenceMap[key]) {
                        setLS(persistenceMap[key], elem.type === 'checkbox' ? elem.checked : elem.value);
                    }
                    updatePreview();
                });
            }
        });
        
        els.genKnowledge.addEventListener('change', () => {
            els.genKnowledgeFields.classList.toggle('hidden', !els.genKnowledge.checked);
            updatePreview();
        });
        
        els.domain.addEventListener("change", () => {
            const preset = domainManager.getDomainPresets()[els.domain.value];
            if (!preset) return;
            showModal(
                "Appliquer le domaine", "Cette action va écraser les paramètres de tâche et de critères. Continuer ?",
                () => {
                    if (preset.tasks?.[0]) {
                        els.task.value = preset.tasks[0];
                        setLS("dsi_task", els.task.value);
                    }
                    Object.entries(preset.toggles || {}).forEach(([key, checked]) => {
                        els[key].checked = checked;
                        setLS(`dsi_${key}`, checked);
                    });
                    renderQuickTasks();
                    updatePreview();
                }
            );
        });
        els.teamMode.addEventListener("change", renderTeamAdds);
        els.team.addEventListener("change", renderTeamAdds);
        
        // Navigation
        document.querySelectorAll('[data-target]').forEach(card => {
            card.addEventListener('click', () => {
                const targetPanelId = card.getAttribute('data-target');
                const targetPanel = document.getElementById(targetPanelId);
                showPanel(targetPanel);
            });
        });

        els.homeBtn.addEventListener('click', () => showPanel(els.homePanel));
        
        els.settingsBtn.addEventListener('click', () => {
            showPanel(els.settingsPanel);
        });
        els.closeSettingsBtn.addEventListener('click', () => {
            showPanel(els.homePanel); 
        });

        els.bgColor.addEventListener('input', (e) => { setLS("dsi_bg_color", e.target.value); applyVisualSettings(); });
        els.resetBgColor.addEventListener('click', () => { setLS("dsi_bg_color", "#f9fafb"); els.bgColor.value = "#f9fafb"; applyVisualSettings(); });
        els.titleColor.addEventListener('input', (e) => { setLS("dsi_title_color", e.target.value); applyVisualSettings(); });
        els.resetTitleColor.addEventListener('click', () => { setLS("dsi_title_color", "#1f2937"); els.titleColor.value = "#1f2937"; applyVisualSettings(); });

        const handleImageUpload = (fileInput, storageKey, removeBtn) => {
             const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    setLS(storageKey, e.target.result);
                    if (removeBtn) removeBtn.classList.remove('hidden');
                    applyVisualSettings();
                };
                reader.readAsDataURL(file);
            }
        };

        els.bgImageFile.addEventListener('change', () => handleImageUpload(els.bgImageFile, "dsi_bg_image", els.removeBgImage));
        els.removeBgImage.addEventListener('click', () => {
            setLS("dsi_bg_image", "");
            els.bgImageFile.value = '';
            els.removeBgImage.classList.add('hidden');
            applyVisualSettings();
        });

        els.logoFile.addEventListener('change', () => handleImageUpload(els.logoFile, "dsi_logo", els.removeLogo));
        els.removeLogo.addEventListener('click', () => {
            showModal("Supprimer le logo", "Êtes-vous sûr de vouloir supprimer le logo ?", () => {
                setLS("dsi_logo", "");
                els.logoFile.value = '';
                applyVisualSettings();
            });
        });

        els.addDomain.addEventListener("click", domainManager.add);
        
        const setupCopyButton = async (btn, badge, preview) => {
            try {
                await navigator.clipboard.writeText(preview.textContent);
                badge.classList.remove("hidden");
                setTimeout(() => badge.classList.add("hidden"), 2000);
            } catch {
                alert("Impossible de copier. Sélectionnez le texte et copiez manuellement.");
            }
        };

        els.copyBtn.addEventListener("click", () => {
             setupCopyButton(els.copyBtn, els.copiedBadge, els.preview);
             els.clearBtn.classList.remove("hidden");
        });
        els.summaryCopyBtn.addEventListener('click', () => setupCopyButton(els.summaryCopyBtn, els.summaryCopiedBadge, els.summaryPreview));
        els.guidedCopyBtn.addEventListener('click', () => setupCopyButton(els.guidedCopyBtn, els.guidedCopiedBadge, els.guidedPreview));

        els.clearBtn.addEventListener("click", () => {
            showModal("Effacer les entrées", "Ceci va effacer toutes les entrées du Prompt Builder. Continuer ?", () => {
                const textInputs = [els.task, els.company, els.sector, els.audience, els.goals, els.constraints, els.deadline, els.examples, els.acceptance, els.length, els.knowledgeSubject];
                textInputs.forEach(input => { input.value = ''; setLS(`dsi_${input.id}`, ''); });
                const checkboxes = [els.risks, els.costs, els.kpi, els.deps, els.limits, els.sources, els.allowUnknown, els.listUnknowns, els.chainOfThought, els.genKnowledge, els.selfReflection];
                checkboxes.forEach(cb => { cb.checked = false; setLS(`dsi_${cb.id}`, false); });
                els.genKnowledgeFields.classList.add('hidden');
                
                const selects = [els.domain, els.format, els.detail, els.lang, els.tone, els.role, els.team];
                selects.forEach(select => { select.selectedIndex = 0; setLS(`dsi_${select.id}`, select.value); });
                els.clearBtn.classList.add("hidden");
                updatePreview();
            });
        });

        els.exportBtn.addEventListener("click", () => {
            showModal("Exporter la configuration", "Ceci va télécharger votre configuration actuelle.", () => {
                const config = Object.fromEntries(Object.entries(persistenceMap).map(([elKey, lsKey]) => [elKey, getLS(lsKey, els[elKey]?.value)]));
                config.roles = getLS("dsi_custom_role", []);
                config.custom_formats = getLS("dsi_custom_format", []);
                config.custom_details = getLS("dsi_custom_detail", []);
                config.custom_tones = getLS("dsi_custom_tone", []);
                config.custom_langs = getLS("dsi_custom_lang", []);
                config.custom_domains = getLS("dsi_custom_domains", {});
                
                config.visualSettings = {
                    bgColor: getLS("dsi_bg_color", "#f9fafb"), bgImage: getLS("dsi_bg_image", ""),
                    titleColor: getLS("dsi_title_color", "#1f2937"), logo: getLS("dsi_logo", DEFAULT_LOGO)
                };

                const blob = new Blob([JSON.stringify(config, null, 2)], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = "prompt_builder_config.json";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        });

        els.importFile.addEventListener("change", async (e) => {
            const file = e.target.files?.[0];
            if (!file) return;
            showModal("Importer une configuration", "Ceci va écraser votre configuration actuelle. Continuer ?", async () => {
                try {
                    const text = await file.text();
                    const config = JSON.parse(text);
                    Object.entries(config).forEach(([key, value]) => {
                        if (persistenceMap[key]) setLS(persistenceMap[key], value);
                    });
                    if (config.roles) { setLS("dsi_custom_role", config.roles); }
                    if (config.custom_formats) { setLS("dsi_custom_format", config.custom_formats); }
                    if (config.custom_details) { setLS("dsi_custom_detail", config.custom_details); }
                    if (config.custom_tones) { setLS("dsi_custom_tone", config.custom_tones); }
                    if (config.custom_langs) { setLS("dsi_custom_lang", config.custom_langs); }
                    if (config.custom_domains) { setLS("dsi_custom_domains", config.custom_domains); }
                    
                    if (config.visualSettings) {
                        setLS("dsi_bg_color", config.visualSettings.bgColor);
                        setLS("dsi_bg_image", config.visualSettings.bgImage);
                        setLS("dsi_title_color", config.visualSettings.titleColor);
                        setLS("dsi_logo", config.visualSettings.logo);
                    }
                    alert("Configuration importée ! La page va être rechargée.");
                    location.reload();
                } catch (error) {
                    alert(`Erreur d'import : ${error.message}`);
                }
            });
        });

        const summaryInputs = [
            els.summaryContextType, els.summaryContextAudience, els.summaryContextObjective,
            els.summaryFormatType, els.summaryFormatDetail, els.summaryStructureBullets,
            els.summaryStructureParagraphs, els.summaryStructurePlan, els.summaryStructureTable,
            els.summaryStyleTone, els.summaryStyleComplexity, els.summaryStyleVoice,
            els.summaryAngleIdeas, els.summaryAngleArgs, els.summaryAngleFacts, els.summaryAngleQuotes,
            els.summaryAngleContext, els.summaryAngleDefs, els.summaryAngleLinks,
            els.summaryAnalysisStrengths, els.summaryAnalysisImplications, els.summaryAnalysisQuestions,
            els.summaryAnalysisCompare, els.summaryConstraintLength, els.summaryConstraintOmit,
            els.summaryConstraintTitles, els.summaryConstraintBold
        ];
        summaryInputs.forEach(input => {
            const eventType = (input.type === 'checkbox' || input.tagName === 'SELECT') ? 'change' : 'input';
            input.addEventListener(eventType, updateSummaryPreview);
        });

        const guidedInputs = [
            els.guidedWho, els.guidedWhy, els.guidedDomain, els.guidedResponseType,
            els.guidedFormat, els.guidedStyle, els.guidedLength, els.guidedLanguageLevel,
            els.guidedExamples, els.guidedInclude, els.guidedExclude, els.guidedAdvancedCOT,
            els.guidedAdvancedKnowledge, els.guidedAdvancedSelfReflect, els.guidedMainRequest
        ];
        guidedInputs.forEach(input => {
            const eventType = (input.type === 'checkbox' || input.tagName === 'SELECT') ? 'change' : 'input';
            input.addEventListener(eventType, updateGuidedPreview);
        });

        // Event listeners pour les nouveaux assistants
        els.infoTask.addEventListener('input', updateInfoPreview);
        els.creationTask.addEventListener('input', updateCreationPreview);
        els.analysisTask.addEventListener('input', updateAnalysisPreview);
        els.problemTask.addEventListener('input', updateProblemPreview);
        els.trainingTask.addEventListener('input', updateTrainingPreview);
        els.organizationTask.addEventListener('input', updateOrganizationPreview);
        els.simulationTask.addEventListener('input', updateSimulationPreview);

        // Rendu initial
        renderQuickTasks();
        renderTeamAdds();
        els.genKnowledgeFields.classList.toggle('hidden', !els.genKnowledge.checked);
        updatePreview();
        updateSummaryPreview();
        updateGuidedPreview();
        updateInfoPreview();
        updateCreationPreview();
        updateAnalysisPreview();
        updateProblemPreview();
        updateTrainingPreview();
        updateOrganizationPreview();
        updateSimulationPreview();
        
        showPanel(els.homePanel); // Afficher la page d'accueil au démarrage
    };

    init();
});
</script>

<script>
    if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
            navigator.serviceWorker.register("/Prompt_builder_PWA/service-worker.js");
        });
    }

    // --- Assistant Développeurs : génération du prompt ---
    const assembleDevelopersPrompt = () => {
      const v = el => (el && el.value ? el.value.trim() : '');
      const c = el => !!(el && el.checked);
      const parts = [];
      const langOut = v(els.devResponseLang) || 'Français';

      parts.push(`Tu es un **développeur senior**. Réponds en ${langOut}.`);
      parts.push(`### Demande
- Type : ${v(els.devRequestType) || 'À préciser'}
- Objectif : ${(v(els.devSpecs) || v(els.devContext) || 'Préciser le besoin')}`);

      const stack = [];
      if (v(els.devLanguages)) stack.push(`Langages/Technos : ${v(els.devLanguages)}`);
      if (v(els.devEnv)) stack.push(`Environnement/Versions : ${v(els.devEnv)}`);
      if (stack.length) parts.push("### Stack & Environnement\n" + stack.join("\n"));

      if (v(els.devContext)) parts.push("### Contexte du projet\n" + v(els.devContext));
      if (v(els.devSpecs)) parts.push("### Spécifications & Cas d'usage\n" + v(els.devSpecs));

      const io = [];
      if (v(els.devInputs)) io.push(`Entrées/Données : ${v(els.devInputs)}`);
      if (v(els.devEdgeCases)) io.push(`Cas limites & jeux d'essai : ${v(els.devEdgeCases)}`);
      if (io.length) parts.push("### Données & Scénarios\n" + io.join("\n"));

      if (v(els.devConstraints)) parts.push("### Contraintes techniques\n" + v(els.devConstraints));

      const outReq = [];
      outReq.push(`Format de sortie attendu : ${v(els.devOutputType) || 'Snippet unique'}`);
      if (c(els.devFileTree)) outReq.push("Inclure **l'arborescence des fichiers** (avec chemins).");
      if (c(els.devInstructions)) outReq.push("Inclure **les commandes d'installation et d'exécution** (+ dépendances).");
      if (c(els.devTests)) {
        const tf = v(els.devTestFrameworks);
        outReq.push("Inclure **des tests**" + (tf ? ` (${tf})` : "") + " et expliquer comment les exécuter.");
      }
      if (c(els.devReadyCode)) outReq.push("Fournir du **code complet prêt à copier-coller** (imports corrects, point d'entrée, pas de pseudo-code).");
      parts.push("### Sortie attendue\n" + outReq.map(x => `- ${x}`).join("\n"));

      const guidance = [];
      guidance.push(`Niveau d'explication : ${v(els.devExplainLevel) || 'Intermédiaire — Commenté (directif)'}.`);
      if (c(els.devStepByStep)) guidance.push("Avant de coder, **expose ton raisonnement étape par étape** (plan, choix techniques).");
      guidance.push("Respecter les bonnes pratiques : lisibilité, gestion des erreurs, sécurité de base, performance.");
      parts.push("### Directives\n" + guidance.map(x => `- ${x}`).join("\n"));

      const existingCodeEl = document.getElementById('dev-existing-code');
      if (existingCodeEl && existingCodeEl.value.trim()) {
        parts.push("### Code existant à considérer\n```text\n" + existingCodeEl.value.trim() + "\n```");
      }

      parts.push("### Formatage de la réponse\n- Utilise des **blocs de code** par fichier.\n- Si plusieurs fichiers : donne les **chemins** et un **README court**.\n- Évite les placeholders, privilégie des exemples **exécutables** / un **exemple minimal reproductible**.");
      return parts.join("\n\n");
    };

    const updateDevelopersPreview = () => {
      if (els.developersPreview) els.developersPreview.textContent = assembleDevelopersPrompt();
    };

</script>



<script>
/* Fallbacks robustes & comportements uniformes
   - Injecter la tuile "Développeurs" si absente
   - Développeurs : génération LIVE + bouton "Effacer les données" (affiché après "Copier")
   - Assistant Guidé : bouton "Effacer les données" (affiché après "Copier"), reset fiable
*/
(function(){
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

  // 1) Toujours garantir la tuile "Développeurs"
  function ensureDevelopersTile(){
    if (document.querySelector('[data-target="assistant-developers-panel"]')) return;
    const sim = document.querySelector('[data-target="assistant-simulation-panel"]');
    if (!sim || !sim.parentElement) return;
    const card = document.createElement('div');
    card.className = sim.className;
    card.setAttribute('data-target','assistant-developers-panel');
    card.innerHTML = '<h4 class="font-semibold text-indigo-700">Développeurs</h4><p class="text-xs text-gray-500 mt-1">Création, assistance, debug, revue et tests de code.</p>';
    sim.parentElement.appendChild(card);
    card.addEventListener('click', () => {
      const panel = $('#assistant-developers-panel');
      if (!panel) return;
      if (typeof window.showPanel === 'function') showPanel(panel);
      else {
        $$('#home-panel, [id^="assistant-"], #settings-panel').forEach(p => p && p.classList.add('hidden'));
        panel.classList.remove('hidden');
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }

  // 2) Assembleur local pour Développeurs (si assembleDevelopersPrompt n'est pas présent)
  function localAssembleDevelopersPrompt(){
    const gv = id => { const el = $('#'+id); return el && el.value ? el.value.trim() : ''; };
    const ck = id => { const el = $('#'+id); return !!(el && el.checked); };
    if (!$('#assistant-developers-panel')) return '';
    const parts = [];
    const langOut = gv('dev-response-lang') || 'Français';
    parts.push(`Tu es un **développeur senior**. Réponds en ${langOut}.`);
    parts.push(`### Demande\n- Type : ${gv('dev-request-type') || 'À préciser'}\n- Objectif : ${(gv('dev-specs') || gv('dev-context') || 'Préciser le besoin')}`);
    const stack = [];
    if (gv('dev-languages')) stack.push(`Langages/Technos : ${gv('dev-languages')}`);
    if (gv('dev-env')) stack.push(`Environnement/Versions : ${gv('dev-env')}`);
    if (stack.length) parts.push("### Stack & Environnement\n" + stack.join("\n"));
    if (gv('dev-context')) parts.push("### Contexte du projet\n" + gv('dev-context'));
    if (gv('dev-specs')) parts.push("### Spécifications & Cas d'usage\n" + gv('dev-specs'));
    const io = [];
    if (gv('dev-inputs')) io.push(`Entrées/Données : ${gv('dev-inputs')}`);
    if (gv('dev-edge-cases')) io.push(`Cas limites & jeux d'essai : ${gv('dev-edge-cases')}`);
    if (io.length) parts.push("### Données & Scénarios\n" + io.join("\n"));
    if (gv('dev-constraints')) parts.push("### Contraintes techniques\n" + gv('dev-constraints'));
    const outReq = [];
    outReq.push(`Format de sortie attendu : ${gv('dev-output-type') || 'Snippet unique'}`);
    if (ck('dev-file-tree')) outReq.push("Inclure **l'arborescence des fichiers** (avec chemins).");
    if (ck('dev-instructions')) outReq.push("Inclure **les commandes d'installation et d'exécution** (+ dépendances).");
    if (ck('dev-tests')){
      const tf = gv('dev-test-frameworks');
      outReq.push("Inclure **des tests**" + (tf?` (${tf})`:"") + " et expliquer comment les exécuter.");
    }
    if (ck('dev-ready-code')) outReq.push("Fournir du **code complet prêt à copier-coller** (imports corrects, point d'entrée, pas de pseudo-code).");
    parts.push("### Sortie attendue\n" + outReq.map(x=>`- ${x}`).join("\n"));
    const lvl = gv('dev-explain-level') || 'Intermédiaire — Commenté (directif)';
    const guidance = [];
    guidance.push(`Niveau d'explication : ${lvl}.`);
    if (ck('dev-step-by-step')) guidance.push("Avant de coder, **expose ton raisonnement étape par étape** (plan, choix techniques).");
    guidance.push("Respecter les bonnes pratiques : lisibilité, gestion des erreurs, sécurité de base, performance.");
    parts.push("### Directives\n" + guidance.map(x=>`- ${x}`).join("\n"));
    const ex = $('#dev-existing-code');
    if (ex && ex.value.trim()) parts.push("### Code existant à considérer\n```text\n" + ex.value.trim() + "\n```");
    parts.push("### Formatage de la réponse\n- Utilise des **blocs de code** par fichier.\n- Si plusieurs fichiers : donne les **chemins** et un **README court**.\n- Évite les placeholders, privilégie des exemples **exécutables** / un **exemple minimal reproductible**.");
    return parts.join("\n\n");
  }

  function bindDevelopers(){
    const panel = $('#assistant-developers-panel');
    const prev = $('#developers-preview');
    if (!panel || !prev) return;
    const assemble = (typeof window.assembleDevelopersPrompt === 'function') ? window.assembleDevelopersPrompt : localAssembleDevelopersPrompt;
    const update = () => { try { prev.textContent = assemble(); } catch(e){} };
    // Live preview
    $$('#assistant-developers-panel input, #assistant-developers-panel select, #assistant-developers-panel textarea').forEach(el => {
      const evt = (el.type === 'checkbox' || el.tagName === 'SELECT') ? 'change' : 'input';
      el.addEventListener(evt, update);
    });
    update();
    // Copier
    const copyBtn = $('#developers-copy-btn');
    const copied = $('#developers-copied-badge');
    const prevNode = $('#developers-preview');
    if (copyBtn && !copyBtn.dataset.boundCopy){
      copyBtn.dataset.boundCopy = '1';
      if (typeof window.setupCopyButton === 'function'){
        copyBtn.addEventListener('click', () => setupCopyButton(copyBtn, copied, prevNode));
      } else {
        copyBtn.addEventListener('click', async () => {
          try { await navigator.clipboard.writeText(prevNode?.innerText || ''); if (copied){ copied.classList.remove('hidden'); setTimeout(()=>copied.classList.add('hidden'), 1200); } } catch(e){}
        });
      }
    }
    // Effacer les données (dev) : création si absente + reveal après "Copier"
    let clearBtn = $('#developers-clear-btn');
    const badge = $('#developers-copied-badge');
    if (!clearBtn && badge){
      clearBtn = document.createElement('button');
      clearBtn.id = 'developers-clear-btn';
      clearBtn.className = 'hidden px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors';
      clearBtn.textContent = 'Effacer les données';
      badge.parentElement && badge.parentElement.appendChild(clearBtn);
    }
    if (copyBtn && clearBtn && !copyBtn.dataset.boundShowClear){
      copyBtn.dataset.boundShowClear = '1';
      copyBtn.addEventListener('click', () => { clearBtn.classList.remove('hidden'); });
    }
    if (clearBtn && !clearBtn.dataset.boundClear){
      clearBtn.dataset.boundClear = '1';
      clearBtn.addEventListener('click', () => {
        const doReset = () => {
          $$('#assistant-developers-panel input, #assistant-developers-panel select, #assistant-developers-panel textarea').forEach(el => {
            if (el.tagName === 'SELECT') el.selectedIndex = 0;
            else if (el.type === 'checkbox' || el.type === 'radio') el.checked = false;
            else el.value = '';
          });
          update();
        };
        if (typeof window.showModal === 'function'){
          showModal("Effacer les données", "Ceci va effacer toutes les entrées du panneau Développeurs. Continuer ?", doReset);
        } else {
          if (window.confirm("Effacer toutes les données du panneau Développeurs ?")) doReset();
        }
      });
    }
  }

  // 3) Assistant Guidé : bouton Effacer → reset générique
  function ensureGuided(){
    const badge = $('#guided-copied-badge');
    if (!badge) return;
    let clearBtn = $('#guided-clear-btn');
    if (!clearBtn){
      clearBtn = document.createElement('button');
      clearBtn.id = 'guided-clear-btn';
      clearBtn.className = 'hidden px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors';
      clearBtn.textContent = 'Effacer les données';
      badge.parentElement && badge.parentElement.appendChild(clearBtn);
    }
    const copyBtn = $('#guided-copy-btn');
    if (copyBtn && !copyBtn.dataset.boundClear){
      copyBtn.dataset.boundClear = '1';
      copyBtn.addEventListener('click', () => { clearBtn.classList.remove('hidden'); });
    }
    if (!clearBtn.dataset.bound){
      clearBtn.dataset.bound = '1';
      clearBtn.addEventListener('click', () => {
        const doReset = () => {
          $$('#guided-assistant-panel input, #guided-assistant-panel select, #guided-assistant-panel textarea').forEach(el => {
            if (el.tagName === 'SELECT') el.selectedIndex = 0;
            else if (el.type === 'checkbox' || el.type === 'radio') el.checked = false;
            else el.value = '';
          });
          if (typeof window.updateGuidedPreview === 'function') window.updateGuidedPreview();
        };
        if (typeof window.showModal === 'function'){
          showModal("Effacer les données", "Ceci va effacer toutes les entrées de l'Assistant Guidé. Continuer ?", doReset);
        } else {
          if (window.confirm("Effacer toutes les données du formulaire guidé ?")) doReset();
        }
      });
    }
  }

  function init(){
    ensureDevelopersTile();
    bindDevelopers();
    ensureGuided();
  }

  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
  else init();

  // Mini Check-list (console)
  try {
    console.log('[Check] Tuile Développeurs :', !!document.querySelector('[data-target="assistant-developers-panel"]') ? 'OK' : 'ABSENTE (fallback)');
    console.log('[Check] Bouton Effacer (Développeurs) :', !!document.getElementById('developers-clear-btn') ? 'OK' : 'ABSENT (sera injecté après Copier)');
    console.log('[Check] Bouton Effacer (Guidé) :', !!document.getElementById('guided-clear-btn') ? 'OK' : 'ABSENT (sera injecté après Copier)');
  } catch(e){}
})();
</script>


<script>
/* Uniformisation des tuiles : 
   - injecte "Copier le Prompt" + "Copié ! ✅" + "Effacer les données" s'ils manquent
   - câblage du bouton Copier (badge) et Effacer (reset + refresh)
   - fallback pour génération live (Développeurs déjà couvert)
*/
(function(){
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

  // Fabrique un id base à partir d'un panelId → ex: assistant-info-panel => info
  function baseFromPanelId(pid){
    if (!pid) return null;
    let base = pid.replace(/^-+|_+$/g,'').replace(/-assistant-panel$/,'').replace(/^assistant-/,'').replace(/-panel$/,'');
    return base;
  }

  // Tente d'obtenir la fonction updateXPreview à partir du panel id
  function getUpdateFnForPanel(pid){
    const b = baseFromPanelId(pid);
    if (!b) return null;
    const camel = b.charAt(0).toUpperCase() + b.slice(1);
    const name = 'update' + camel + 'Preview';
    return (typeof window[name] === 'function') ? window[name] : null;
  }

  function ensureControlsForPanel(panel){
    const pid = panel.id;
    const base = baseFromPanelId(pid);
    if (!base) return;

    // Preview area
    let preview = panel.querySelector('#' + base + '-preview') || panel.querySelector('[id$="-preview"]');
    if (!preview) return;

    // Actions container = parent of preview, or create beneath it
    let actionsHost = preview.parentElement;
    // ensure copy button
    let copy = panel.querySelector('#' + base + '-copy-btn');
    if (!copy){
      copy = document.createElement('button');
      copy.id = base + '-copy-btn';
      copy.className = 'mt-3 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700';
      copy.textContent = 'Copier le Prompt';
      actionsHost.appendChild(copy);
    }
    // copied badge
    let badge = panel.querySelector('#' + base + '-copied-badge');
    if (!badge){
      badge = document.createElement('span');
      badge.id = base + '-copied-badge';
      badge.className = 'hidden text-center text-xs text-green-600 font-medium mt-1 inline-block';
      badge.textContent = 'Copié ! ✅';
      actionsHost.appendChild(badge);
    }
    // clear button
    let clear = panel.querySelector('#' + base + '-clear-btn');
    if (!clear){
      clear = document.createElement('button');
      clear.id = base + '-clear-btn';
      clear.className = 'hidden mt-2 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors';
      clear.textContent = 'Effacer les données';
      actionsHost.appendChild(clear);
    }

    // Wiring copy → badge + show clear
    if (!copy.dataset.boundCopy){
      copy.dataset.boundCopy = '1';
      if (typeof window.setupCopyButton === 'function'){
        copy.addEventListener('click', () => window.setupCopyButton(copy, badge, preview));
      } else {
        copy.addEventListener('click', async () => {
          try { await navigator.clipboard.writeText(preview?.innerText || ''); }
          catch(e){ /* noop */ }
          badge.classList.remove('hidden');
          setTimeout(()=>badge.classList.add('hidden'), 1200);
        });
      }
      copy.addEventListener('click', () => clear.classList.remove('hidden'));
    }

    // Wiring clear → reset inputs inside the panel + refresh preview
    if (!clear.dataset.boundClear){
      clear.dataset.boundClear = '1';
      clear.addEventListener('click', () => {
        const doReset = () => {
          $$('input, select, textarea', panel).forEach(el => {
            if (el.tagName === 'SELECT') el.selectedIndex = 0;
            else if (el.type === 'checkbox' || el.type === 'radio') el.checked = false;
            else el.value = '';
          });
          const updateFn = getUpdateFnForPanel(pid);
          if (updateFn) try { updateFn(); } catch(e){}
        };
        if (typeof window.showModal === 'function'){
          showModal("Effacer les données", "Ceci va effacer toutes les entrées du panneau. Continuer ?", doReset);
        } else if (confirm("Effacer toutes les données de ce panneau ?")) {
          doReset();
        }
      });
    }
  }

  function init(){
    const panels = $$('[id$="-assistant-panel"], [id^="assistant-"][id$="-panel"]');
    panels.forEach(ensureControlsForPanel);
  }

  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
  else init();
})();
</script>


<script>
/* 🔧 Injection "Prompt parfait" v3 — familles: Information, Création, Analyse, Résolution, Entraînement, Organisation, Simulation
   - Champs dans la colonne gauche (formulaire) pour respecter l'UX 2 colonnes
   - Détection robuste de la tuile "Résolution"
   - Ajout live d'un bloc "Paramètres avancés (auto-générés)" dans l'aperçu (droite)
*/
(function(){
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

  function detectFamilyByPanel(panel){
    const id = (panel && panel.id) || '';
    const h = (panel.querySelector('h2, h3, h4')?.textContent || '').toLowerCase();
    if (/assistant-(info|information)-panel/.test(id) || /information|compr[ée]hension/.test(h)) return 'information';
    if (/assistant-(creation|production)-panel/.test(id) || /cr[ée]ation|production/.test(h)) return 'creation';
    if (/assistant-(analysis|structuration)-panel/.test(id) || /analyse|structuration/.test(h)) return 'analysis';
    if (/assistant-(resolution|resolutions|resolve|problems?|troubleshooting|depann?age|reparation)-panel/.test(id) || /r[ée]solution|d[ée]pannage|troubleshooting|probl/.test(h)) return 'resolution';
    if (/assistant-(training|apprentissage|entrainement)-panel/.test(id) || /entra[iî]nement|apprentissage|training/.test(h)) return 'training';
    if (/assistant-(organization|organisation|productivity)-panel/.test(id) || /organisation|productivit[ée]/.test(h)) return 'organization';
    if (/assistant-simulation-panel/.test(id) || /simulation|dialogue/.test(h)) return 'simulation';
    return null;
  }

  function el(tag, attrs={}, ...children){
    const n = document.createElement(tag);
    Object.entries(attrs).forEach(([k,v]) => {
      if (k==='class') n.className = v;
      else if (k==='for') n.htmlFor = v;
      else if (k.startsWith('on') && typeof v === 'function') n.addEventListener(k.slice(2), v);
      else n.setAttribute(k, v);
    });
    children.forEach(ch => { if (typeof ch === 'string') n.appendChild(document.createTextNode(ch)); else if (ch) n.appendChild(ch); });
    return n;
  }
  function select(id, label, options, help){ const s = el('select',{id, class:'mt-1 block w-full rounded-md border-gray-300'}); options.forEach(o=>s.appendChild(el('option',{},o))); return fieldWrap(id,label,s,help); }
  function input(id, label, placeholder=''){ return fieldWrap(id,label, el('input',{id,class:'mt-1 block w-full rounded-md border-gray-300', placeholder})); }
  function number(id, label, placeholder=''){ return fieldWrap(id,label, el('input',{id,type:'number',class:'mt-1 block w-full rounded-md border-gray-300', placeholder})); }
  function textarea(id, label, rows=3, placeholder=''){ return fieldWrap(id,label, el('textarea',{id,rows:String(rows),class:'mt-1 block w-full rounded-md border-gray-300', placeholder})); }
  function tags(id, label, placeholder=''){ return fieldWrap(id,label+' (séparés par des virgules)', el('input',{id,class:'mt-1 block w-full rounded-md border-gray-300', placeholder})); }
  function toggle(id, label){ const c = el('input',{id,type:'checkbox',class:'h-4 w-4 rounded'}); return el('div',{}, el('label',{class:'flex items-center space-x-2'}, c, el('span',{class:'text-sm text-gray-700'}, label))); }
  function toggleWithTextarea(id, label, taId, rows=3, placeholder=''){ const t=toggle(id,label); const ta=el('textarea',{id:taId,rows:String(rows),class:'mt-2 w-full rounded-md border-gray-300 hidden',placeholder}); t.querySelector('input').addEventListener('change',e=>{ta.classList.toggle('hidden',!e.target.checked)}); return el('div',{},t,ta); }
  function fieldWrap(id,label,control,help){ const lab=el('label',{class:'block text-sm font-medium text-gray-700',for:id},label); const div=el('div',{},lab,control); if(help) div.appendChild(el('p',{class:'text-xs text-gray-500 mt-1'},help)); div.dataset.fieldId=id; return div; }
  function section(title,...children){ return el('div',{class:'space-y-4 border border-gray-200 rounded-lg p-4 bg-gray-50'}, el('h3',{class:'text-sm font-semibold text-gray-800 tracking-wide uppercase'},title), ...children); }
  function row3(...cols){ return el('div',{class:'grid grid-cols-1 md:grid-cols-3 gap-4'}, ...cols); }

  function socle(prefix){
    return section('Socle commun',
      textarea(prefix+'-ctx','Contexte / objectif',3,'Qui, pourquoi, pour quoi faire ?'),
      row3(
        select(prefix+'-public','Public cible',['Débutant','Intermédiaire','Expert','Dirigeant']),
        input(prefix+'-domaine','Domaine / sujet','ex: cybersécurité, marketing SaaS…'),
        select(prefix+'-format','Format de sortie',['Bullet points','Tableau','Plan 1-2-3','Résumé','Checklist','Rapport'])
      ),
      row3(
        select(prefix+'-ton','Ton',['Neutre','Pédagogique','Professionnel','Analytique','Concis']),
        select(prefix+'-detail','Niveau de détail',['Ultra-condensé','Intermédiaire','Approfondi']),
        input(prefix+'-longueur','Longueur cible','ex: 200 mots / 7 puces / 4 colonnes')
      ),
      input(prefix+'-contraintes','Contraintes','ex: éviter le jargon ; inclure des exemples'),
      toggle(prefix+'-plan','Plan d’approche (sans introspection) — 3–6 étapes brèves'),
      toggleWithTextarea(prefix+'-connaissances','Connaissances de base — fourni vs inféré + incertitudes',prefix+'-connaissances-notes',3,'Données fournies / hypothèses / incertitudes'),
      toggleWithTextarea(prefix+'-auto','Auto-évaluation — critères, risques, correction rapide',prefix+'-auto-notes',3,'3 critères d’acceptation, 2 risques, 1 correction express'),
      input(prefix+'-echeance','Échéance / priorité','ex: aujourd’hui 16h / P1'),
      textarea(prefix+'-sources','Sources / données d’entrée',3,'liens, docs, extraits…')
    );
  }

  const familyUI = {
    information(prefix){ return section('Spécifique — Information / compréhension',
      select(prefix+'-niveau-vulg','Niveau de vulgarisation',['Enfant (12–14)','Lycéen','Grand public','Étudiant','Professionnel']),
      textarea(prefix+'-notions','Notions à couvrir',2,'définitions, exemples, analogies…'),
      tags(prefix+'-exclure','Points à exclure','ex: maths avancées, théorie XY'),
      number(prefix+'-exemples','Exemples concrets requis','ex: 2'),
      toggleWithTextarea(prefix+'-comparaison','Comparaison nécessaire',prefix+'-comparaison-avec',2,'Comparer avec…'),
      toggle(prefix+'-glossaire','Glossaire / définitions (mini-glossaire)'),
      toggle(prefix+'-illustrations','Illustrations textuelles (schéma décrit en texte)'),
      toggleWithTextarea(prefix+'-faq','Questions fréquentes (FAQ)',prefix+'-faq-nb',1,'ex: 5 Q/R')
    );},
    creation(prefix){ return section('Spécifique — Production / création',
      select(prefix+'-canal','Canal / support',['Article','Post LinkedIn','Script vidéo','Email','Landing page']),
      input(prefix+'-voix','Voix & persona de marque','ex: sobre, inspirant, premium'),
      select(prefix+'-intent','Intent principal',['Informer','Convaincre','Convertir','Engager']),
      select(prefix+'-structure','Structure attendue',['AIDA','PAS','Story arc','Liste','Dialogue']),
      toggleWithTextarea(prefix+'-cta','CTA obligatoire',prefix+'-cta-texte',2,'ex: prendre RDV, s’abonner…'),
      tags(prefix+'-keywords','Mots-clés à inclure','SEO, thèmes…'),
      tags(prefix+'-avoid','Éléments à éviter','claims interdits, ton agressif…'),
      number(prefix+'-variantes','Variantes / itérations','ex: 5'),
      textarea(prefix+'-stylex','Exemples de style (liens / citations courtes)',2,'Références stylistiques…')
    );},
    analysis(prefix){ return section('Spécifique — Analyse / structuration',
      select(prefix+'-type','Type d’analyse',['Comparatif','SWOT','PESTEL','Gap','Risques']),
      tags(prefix+'-criteres','Critères d’évaluation','coût, délai, impact, risques, complexité…'),
      input(prefix+'-poids','Pondération des critères (clé:valeur)','ex: coût:40, délai:20, …'),
      input(prefix+'-seuils','Seuils / contraintes','ex: budget ≤ 50k, délai ≤ 3 mois'),
      textarea(prefix+'-hypotheses','Hypothèses de travail',2,'Hypothèses explicites…'),
      tags(prefix+'-options','Options à comparer','X, Y, Z…'),
      toggleWithTextarea(prefix+'-reco','Recommandation attendue',prefix+'-reco-notes',2,'Verdict en 2 phrases + justification'),
      textarea(prefix+'-risques','Risques & mitigations',2,'Top-3 risques + parades'),
      toggleWithTextarea(prefix+'-planexec','Plan d’exécution',prefix+'-planexec-steps',1,'ex: 5 étapes')
    );},
    resolution(prefix){ return section('Spécifique — Résolution de problèmes',
      textarea(prefix+'-ctxtech','Contexte technique',2,'stack, versions, OS, environnement…'),
      textarea(prefix+'-sympt','Symptômes / messages d’erreur',2,'logs, codes, captures…'),
      select(prefix+'-impact','Étendue d’impact',['1 utilisateur','Équipe','Production']),
      textarea(prefix+'-changes','Changements récents',2,'déploiements, config, dépendances…'),
      textarea(prefix+'-politiques','Contraintes & politiques',2,'sécurité, conformité, SLA…'),
      textarea(prefix+'-outils','Outils & accès disponibles',2,'observabilité, droits…'),
      number(prefix+'-diagnostic-steps','Checklist de diagnostic — nombre d’étapes','ex: 6'),
      toggle(prefix+'-solutions-prio','Solutions par priorité (impact ↑ / effort ↓)'),
      textarea(prefix+'-rollback','Rollback / Plan B',2,'réversibilité…'),
      textarea(prefix+'-validation','Critères de validation',2,'indicateurs “fix ok”…')
    );},
    training(prefix){ return section('Spécifique — Apprentissage / entraînement',
      select(prefix+'-objectif','Objectif pédagogique',['Mémoriser','Comprendre','Appliquer','Évaluer']),
      select(prefix+'-bloom','Niveau Bloom',['Remember','Understand','Apply','Analyze','Evaluate','Create']),
      textarea(prefix+'-prereq','Pré-requis',2,'Notions à connaître…'),
      select(prefix+'-exo','Type d’exercice',['QCM','Vrai-Faux','Cas pratique','Flashcards']),
      number(prefix+'-items','Nombre d’items','ex: 10'),
      select(prefix+'-feedback','Feedback attendu',['Immédiat','En fin','Explication courte']),
      toggleWithTextarea(prefix+'-bareme','Barème / correction',prefix+'-bareme-notes',2,'Points, critères…'),
      toggle(prefix+'-progression','Progression par niveaux (débutant → avancé)'),
      input(prefix+'-temps','Temps estimé','ex: 15 min')
    );},
    organization(prefix){ return section('Spécifique — Organisation / productivité',
      select(prefix+'-livrable','Type de livrable',['CR de réunion','To-do','Rétroplanning','Modèle d’email']),
      textarea(prefix+'-cadre','Cadre / réunion',2,'objectifs, participants, date…'),
      tags(prefix+'-decisions','Décisions attendues','À prendre, validées…'),
      textarea(prefix+'-actions','Actions / responsables (table simplifiée)',3,'tâche, owner, échéance, statut…'),
      select(prefix+'-prio','Priorisation',['P1','P2','P3']),
      textarea(prefix+'-jalons','Jalons & deadlines (table simplifiée)',2,'jalon, date, dépendances…'),
      select(prefix+'-docfmt','Format documentaire',['Markdown','Tableau','Sections']),
      select(prefix+'-diffusion','Diffusion',['Interne','Client','Direction']),
      toggleWithTextarea(prefix+'-checklist','Checklist de complétude',prefix+'-checklist-items',2,'Sections obligatoires…')
    );},
    simulation(prefix){ return section('Spécifique — Interaction / dialogue simulé',
      input(prefix+'-role','Rôle de l’IA','recruteur, coach, client exigeant…'),
      textarea(prefix+'-persona','Persona détaillé',3,'âge, métier, objectifs, biais, style…'),
      textarea(prefix+'-cadre','Cadre de la situation',2,'contexte, enjeux, contraintes…'),
      tags(prefix+'-objectifs','Objectifs de la simulation','s’entraîner, tester arguments, apprendre…'),
      select(prefix+'-style','Style d’interaction',['Socratique','Challengeant','Bienveillant','Factuel']),
      number(prefix+'-tours','Durée / nombre d’échanges','ex: 8'),
      textarea(prefix+'-nepas','Éléments à ne pas sortir du rôle',2,'frontières / disclaimers…'),
      textarea(prefix+'-eval','Critères d’évaluation',2,'Ce qui fait un bon échange…'),
      toggleWithTextarea(prefix+'-debrief','Débrief attendu',prefix+'-debrief-notes',2,'Feedback structuré en fin…')
    );}
  };

  function findFormColumn(panel){
    return panel.querySelector('.bg-white.p-6') || panel.querySelector('.bg-white.p-6.rounded-lg') || panel.querySelector('.bg-white') || panel;
  }

  function buildCriteriaFor(panel, family){
    const formCol = findFormColumn(panel);
    if (!formCol) return;
    const mark = 'pprompt-block-' + family;
    if (formCol.querySelector('[data-pprompt="'+mark+'"]')) return;

    const container = document.createElement('div');
    container.className = 'mt-4 space-y-4';
    container.setAttribute('data-pprompt', mark);
    container.appendChild(socle(family));
    const spec = familyUI[family]; if (spec) container.appendChild(spec(family));
    container.appendChild(section('Critères d’acceptation', textarea(family+'-acceptance','Critères (3 puces max)',3,'Résultat considéré acceptable si…')));
    formCol.appendChild(container);

    // Live recompute → append to preview
    const preview = panel.querySelector('[id$="-preview"]');
    const marker = '\n\n### Paramètres avancés (auto-générés)';
    const recompute = () => {
      if (!preview) return;
      const extras = composeExtras(family);
      const core = preview.textContent.split(marker)[0];
      preview.textContent = core + (extras || '');
    };
    container.querySelectorAll('input,select,textarea').forEach(el=>{
      const evt = (el.type==='checkbox' || el.tagName==='SELECT') ? 'change':'input';
      el.addEventListener(evt, recompute);
    });

    // Hook updateXPreview si existant
    const pid = panel.id;
    const base = pid.replace(/^assistant-/, '').replace(/-assistant-panel| -panel/g, '');
    const camel = base.charAt(0).toUpperCase() + base.slice(1);
    ['update'+camel+'Preview','update'+camel.replace(/-.*/,'')+'Preview'].forEach(name=>{
      if (typeof window[name] === 'function' && !window[name].__pprompt_wrapped){
        const orig = window[name];
        window[name] = function(){ try{ orig.apply(this, arguments); } finally { recompute(); } };
        window[name].__pprompt_wrapped = true;
      }
    });

    recompute();
  }

  function composeExtras(family){
    const pre = family + '-';
    const gv = id => { const el = document.getElementById(pre+id); return el ? (el.value || '').trim() : ''; };
    const ck = id => { const el = document.getElementById(pre+id); return !!(el && el.checked); };
    const lines = []; const push = (t, arr) => { const v = arr.filter(Boolean); if (v.length){ lines.push('#### '+t); lines.push('- '+v.join('\n- ')); } };

    const socle = [];
    if (gv('ctx')) socle.push('**Contexte/objectif**: '+gv('ctx'));
    if (gv('public')) socle.push('**Public**: '+gv('public'));
    if (gv('domaine')) socle.push('**Domaine**: '+gv('domaine'));
    if (gv('format')) socle.push('**Format**: '+gv('format'));
    if (gv('ton')) socle.push('**Ton**: '+gv('ton'));
    if (gv('detail')) socle.push('**Détail**: '+gv('detail'));
    if (gv('longueur')) socle.push('**Longueur**: '+gv('longueur'));
    if (gv('contraintes')) socle.push('**Contraintes**: '+gv('contraintes'));
    if (ck('plan')) socle.push('**Plan d’approche**: 3–6 étapes brèves');
    if (ck('connaissances')) socle.push('**Connaissances de base**: '+gv('connaissances-notes'));
    if (ck('auto')) socle.push('**Auto-évaluation**: '+gv('auto-notes'));
    if (gv('echeance')) socle.push('**Échéance/Priorité**: '+gv('echeance'));
    if (gv('sources')) socle.push('**Sources/Entrées**: '+gv('sources'));
    if (socle.length){ lines.push('#### Socle commun'); lines.push('- '+socle.join('\n- ')); }

    if (family==='information'){
      push('Information / compréhension',[ gv('niveau-vulg')&&('Niveau: '+gv('niveau-vulg')), gv('notions')&&('Notions: '+gv('notions')), gv('exclure')&&('Exclure: '+gv('exclure')), gv('exemples')&&('Exemples concrets requis: '+gv('exemples')), ck('comparaison')&&('Comparer avec: '+gv('comparaison-avec')), ck('glossaire')&&'Mini-glossaire requis', ck('illustrations')&&'Illustrations textuelles (schémas en texte)', ck('faq')&&('FAQ: '+(gv('faq-nb')||'5')+' Q/R') ]);
    } else if (family==='creation'){
      push('Production / création',[ gv('canal')&&('Canal: '+gv('canal')), gv('voix')&&('Voix/persona: '+gv('voix')), gv('intent')&&('Intent: '+gv('intent')), gv('structure')&&('Structure: '+gv('structure')), ck('cta')&&('CTA: '+gv('cta-texte')), gv('keywords')&&('Mots-clés: '+gv('keywords')), gv('avoid')&&('Éviter: '+gv('avoid')), gv('variantes')&&('Variantes: '+gv('variantes')), gv('stylex')&&('Exemples de style: '+gv('stylex')) ]);
    } else if (family==='analysis'){
      push('Analyse / structuration',[ gv('type')&&('Type: '+gv('type')), gv('criteres')&&('Critères: '+gv('criteres')), gv('poids')&&('Pondération: '+gv('poids')), gv('seuils')&&('Seuils/contraintes: '+gv('seuils')), gv('hypotheses')&&('Hypothèses: '+gv('hypotheses')), gv('options')&&('Options: '+gv('options')), ck('reco')&&('Recommandation: '+gv('reco-notes')), gv('risques')&&('Risques & mitigations: '+gv('risques')), ck('planexec')&&('Plan d’exécution — étapes: '+(gv('planexec-steps')||'5')) ]);
    } else if (family==='resolution'){
      push('Résolution de problèmes',[ gv('ctxtech')&&('Contexte technique: '+gv('ctxtech')), gv('sympt')&&('Symptômes/erreurs: '+gv('sympt')), gv('impact')&&('Impact: '+gv('impact')), gv('changes')&&('Changements récents: '+gv('changes')), gv('politiques')&&('Contraintes/politiques: '+gv('politiques')), gv('outils')&&('Outils/accès: '+gv('outils')), gv('diagnostic-steps')&&('Checklist diagnostic: '+gv('diagnostic-steps')+' étapes'), ck('solutions-prio')&&'Solutions par priorité (impact ↑ / effort ↓)', gv('rollback')&&('Rollback/Plan B: '+gv('rollback')), gv('validation')&&('Critères de validation: '+gv('validation')) ]);
    } else if (family==='training'){
      push('Apprentissage / entraînement',[ gv('objectif')&&('Objectif pédagogique: '+gv('objectif')), gv('bloom')&&('Niveau Bloom: '+gv('bloom')), gv('prereq')&&('Pré-requis: '+gv('prereq')), gv('exo')&&('Type d’exercice: '+gv('exo')), gv('items')&&('Nombre d’items: '+gv('items')), gv('feedback')&&('Feedback: '+gv('feedback')), ck('bareme')&&('Barème/correction: '+gv('bareme-notes')), ck('progression')&&'Progression par niveaux', gv('temps')&&('Temps estimé: '+gv('temps')) ]);
    } else if (family==='organization'){
      push('Organisation / productivité',[ gv('livrable')&&('Livrable: '+gv('livrable')), gv('cadre')&&('Cadre/réunion: '+gv('cadre')), gv('decisions')&&('Décisions: '+gv('decisions')), gv('actions')&&('Actions/responsables: '+gv('actions')), gv('prio')&&('Priorisation: '+gv('prio')), gv('jalons')&&('Jalons & deadlines: '+gv('jalons')), gv('docfmt')&&('Format documentaire: '+gv('docfmt')), gv('diffusion')&&('Diffusion: '+gv('diffusion')), ck('checklist')&&('Checklist: '+gv('checklist-items')) ]);
    } else if (family==='simulation'){
      push('Interaction / dialogue simulé',[ gv('role')&&('Rôle IA: '+gv('role')), gv('persona')&&('Persona: '+gv('persona')), gv('cadre')&&('Cadre: '+gv('cadre')), gv('objectifs')&&('Objectifs: '+gv('objectifs')), gv('style')&&('Style: '+gv('style')), gv('tours')&&('Échanges: '+gv('tours')), gv('nepas')&&('Ne pas sortir du rôle: '+gv('nepas')), gv('eval')&&('Critères d’évaluation: '+gv('eval')), ck('debrief')&&('Débrief attendu: '+gv('debrief-notes')) ]);
    }

    if (gv('acceptance')){
      lines.push('#### Critères d’acceptation');
      lines.push('- ' + gv('acceptance').split(/\n+/).map(s=>s.trim()).filter(Boolean).slice(0,3).join('\n- '));
    }

    return lines.length ? ('\n\n### Paramètres avancés (auto-générés)\n' + lines.join('\n') + '\n') : '';
  }

  function init(){
    const panels = $$('[id$="-assistant-panel"], [id^="assistant-"][id$="-panel"]');
    panels.forEach(panel => {
      const family = detectFamilyByPanel(panel);
      if (!family) return;
      buildCriteriaFor(panel, family);
    });
  }
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
  else init();
})();
</script>





<script>
/* 🧭 UX Enforcer v4
   - Gauche = Demande + Critères (formulaires)
   - Droite = Preview + boutons (Copier / Effacer) en sticky (desktop)
   - Répare les boutons (création si manquants + handlers)
   - Colonne gauche: champs en pleine largeur (pas de demi-largeur)
   - Dev tuile: supprime les inner grids trop étroites
*/
(function(){
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

  function findPreview(panel){ return panel.querySelector('[id$="-preview"]'); }
  function findExistingActions(panel){
    return {
      copy: panel.querySelector('[id$="-copy-btn"]'),
      badge: panel.querySelector('[id$="-copied-badge"]'),
      clear: panel.querySelector('[id$="-clear-btn"]')
    };
  }
  function headingPromptNode(panel){
    // Uniquement des h1..h4 contenant 'prompt' ET 'généré/genere' — évite de capturer "Copier le Prompt"
    const hs = panel.querySelectorAll('h1,h2,h3,h4');
    for (const h of hs){
      const t = (h.textContent || '').trim().toLowerCase();
      if (/prompt/.test(t) && /(g[ée]n[ée]r[ée]|genere)/.test(t)) return h;
    }
    return null;
  }

  function ensureTwoColsAndSticky(panel){
    const preview = findPreview(panel);
    if (!preview) return;

    // Create / normalize grid
    let grid = panel.querySelector('[data-uxgrid="1"]');
    if (!grid){
      grid = document.createElement('div');
      grid.setAttribute('data-uxgrid','1');
      grid.className = 'grid grid-cols-1 lg:grid-cols-2 gap-6 overflow-visible';
      const kids = Array.from(panel.children).filter(n => n.tagName !== 'SCRIPT' && n.tagName !== 'STYLE');
      kids.forEach(n => grid.appendChild(n));
      panel.appendChild(grid);
    } else {
      grid.classList.add('grid','grid-cols-1','lg:grid-cols-2','gap-6','overflow-visible');
      grid.classList.remove('md:grid-cols-2');
    }
    panel.classList.add('overflow-visible');

    // Left col
    let left = grid.querySelector('[data-uxcol="left"]');
    if (!left){
      left = document.createElement('div');
      left.setAttribute('data-uxcol','left');
      left.className = 'bg-white p-6 rounded-lg shadow-sm space-y-4';
      grid.insertBefore(left, grid.firstChild);
    } else {
      left.classList.add('bg-white','p-6','rounded-lg','shadow-sm','space-y-4');
    }

    // Right col
    let right = grid.querySelector('[data-uxcol="right"]');
    if (!right){
      right = document.createElement('div');
      right.setAttribute('data-uxcol','right');
      right.className = 'bg-white p-6 rounded-lg shadow-sm space-y-3 lg:sticky top-4 max-h-[calc(100vh-1rem)] overflow-auto self-start';
      grid.appendChild(right);
    } else {
      right.classList.add('lg:sticky','top-4','max-h-[calc(100vh-1rem)]','overflow-auto','self-start');
    }

    // Move preview to right (on top)
    if (!right.contains(preview)){ right.insertBefore(preview, right.firstChild); }

    // Move prompt heading above preview if present
    const h = headingPromptNode(panel);
    if (h){
      const clone = h.cloneNode(true);
      clone.classList.add('text-sm','font-semibold','text-gray-700');
      right.insertBefore(clone, preview);
      try { h.remove(); } catch(e){}
    }

    // Collect form-like blocks and push to left
    const moveToLeft = [];
    Array.from(grid.children).forEach(ch => {
      if (ch === left || ch === right) return;
      if (ch.querySelector && (ch.querySelector('input,select,textarea') || ch.hasAttribute && ch.hasAttribute('data-pprompt'))){
        moveToLeft.push(ch);
      }
    });
    moveToLeft.forEach(n => left.appendChild(n));

    // Widen inner grids (avoid half-width fields)
    left.querySelectorAll('.grid').forEach(g => {
      g.classList.remove('md:grid-cols-2','md:grid-cols-3','grid-cols-2','grid-cols-3');
      g.classList.add('grid-cols-1');
    });

    // Special: Developers tile — squash any 2-col forms inside left
    if (/(develop|d[ée]veloppe)/i.test(panel.id || '') || /(develop|d[ée]veloppe)/i.test(panel.textContent || '')){
      left.querySelectorAll('.grid').forEach(g => {
        g.classList.remove('md:grid-cols-2','grid-cols-2','lg:grid-cols-2');
        g.classList.add('grid-cols-1');
      });
    }

    // Ensure buttons exist and are wired
    const acts = findExistingActions(panel);
    let copyBtn = acts.copy;
    let badge = acts.badge;
    let clearBtn = acts.clear;

    if (!copyBtn){
      copyBtn = document.createElement('button');
      copyBtn.className = 'mt-3 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700';
      copyBtn.textContent = 'Copier le Prompt';
      right.appendChild(copyBtn);
    } else {
      copyBtn.classList.add('mt-3','px-4','py-2','bg-indigo-600','text-white','rounded-md','hover:bg-indigo-700');
      if (!right.contains(copyBtn)) right.appendChild(copyBtn);
    }
    if (!badge){
      badge = document.createElement('span');
      badge.className = 'hidden text-center text-xs text-green-600 font-medium mt-1 inline-block';
      badge.textContent = 'Copié ! ✅';
      right.appendChild(badge);
    } else {
      badge.classList.add('hidden','text-center','text-xs','text-green-600','font-medium','mt-1','inline-block');
      if (!right.contains(badge)) right.appendChild(badge);
    }
    if (!clearBtn){
      clearBtn = document.createElement('button');
      clearBtn.className = 'hidden mt-2 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors';
      clearBtn.textContent = 'Effacer les données';
      right.appendChild(clearBtn);
    } else {
      clearBtn.classList.add('hidden','mt-2','px-4','py-2','bg-red-500','text-white','rounded-md','hover:bg-red-600','transition-colors');
      if (!right.contains(clearBtn)) right.appendChild(clearBtn);
    }

    // Wire copy
    if (!copyBtn.dataset.bound){
      copyBtn.dataset.bound = '1';
      copyBtn.addEventListener('click', async () => {
        try { await navigator.clipboard.writeText(preview?.innerText || ''); } catch(e){ /* no-op */ }
        badge.classList.remove('hidden');
        setTimeout(()=>badge.classList.add('hidden'), 1200);
        clearBtn.classList.remove('hidden');
      });
    }
    // Wire clear
    if (!clearBtn.dataset.bound){
      clearBtn.dataset.bound = '1';
      clearBtn.addEventListener('click', () => {
        const doReset = () => {
          Array.from(panel.querySelectorAll('input,select,textarea')).forEach(el => {
            if (el.tagName === 'SELECT') el.selectedIndex = 0;
            else if (el.type === 'checkbox' || el.type === 'radio') el.checked = false;
            else el.value = '';
          });
          // Try to call an updateXPreview if defined
          const pid = panel.id || '';
          const base = pid.replace(/^assistant-/, '').replace(/-assistant-panel| -panel/g, '');
          const camel = base.charAt(0).toUpperCase() + base.slice(1);
          const names = ['update'+camel+'Preview','update'+camel.replace(/-.*/,'')+'Preview'];
          names.forEach(n => { if (typeof window[n] === 'function'){ try{ window[n](); }catch(e){} } });
        };
        if (typeof window.showModal === 'function'){
          showModal('Effacer les données', 'Ceci va effacer toutes les entrées du panneau. Continuer ?', doReset);
        } else if (confirm('Effacer toutes les données de ce panneau ?')){
          doReset();
        }
      });
    }
  }

  function init(){
    const panels = $$('[id$="-assistant-panel"], [id^="assistant-"][id$="-panel"]');
    panels.forEach(ensureTwoColsAndSticky);
  }
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
  else init();
})();
</script>

</body>
</html>
